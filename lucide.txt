local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local Existing = CoreGui:FindFirstChild("Lucide-Icon")
if Existing then
    Existing:Destroy()
end

local LucideIcons = loadstring(game:HttpGet("https://raw.githubusercontent.com/uwedot/files/refs/heads/main/icons.txt"))()

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Lucide-Icon"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = CoreGui
ScreenGui.DisplayOrder = 1

local function DeepSetZIndex(Obj, Index)
    if Obj:IsA("GuiObject") then
        Obj.ZIndex = Index
    end
    for _, Child in ipairs(Obj:GetChildren()) do
        DeepSetZIndex(Child, Index)
    end
end
DeepSetZIndex(ScreenGui, 1)

local function AddCorner(Parent, Radius)
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = Radius
    Corner.Parent = Parent
end

local function CreateImageButton(Props)
    local Btn = Instance.new("ImageButton")
    Btn.BorderSizePixel = 0
    Btn.BackgroundTransparency = 1
    for K, V in pairs(Props) do
        Btn[K] = V
    end
    return Btn
end

local Lucide = Instance.new("Frame")
Lucide.BorderSizePixel = 0
Lucide.BackgroundColor3 = Color3.fromRGB(31, 31, 31)
Lucide.Size = UDim2.new(0, 602, 0, 278)
Lucide.Position = UDim2.new(0, 70, 0, 12)
Lucide.Name = "Lucide"
Lucide.Parent = ScreenGui
Lucide.Active = true
Lucide.Draggable = true
AddCorner(Lucide, UDim.new(0, 15))

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(52, 52, 52)
UIStroke.Parent = Lucide

local Open = CreateImageButton({
    BackgroundColor3 = Color3.fromRGB(31, 31, 31),
    BackgroundTransparency = 0,
    Image = "rbxassetid://121377864496432",
    Size = UDim2.new(0, 52, 0, 52),
    Position = UDim2.new(0, 12, 0, 25),
    Visible = false,
    Active = true,
    Draggable = true,
    Parent = ScreenGui
})
AddCorner(Open, UDim.new(1, 0))

local TopBar = Instance.new("Frame")
TopBar.BorderSizePixel = 0
TopBar.BackgroundTransparency = 1
TopBar.Size = UDim2.new(0, 590, 0, 34)
TopBar.Position = UDim2.new(0, 6, 0, 4)
TopBar.Name = "TopBar"
TopBar.Parent = Lucide

local RemoveBtn = CreateImageButton({
    Image = "rbxassetid://110786993356448",
    Size = UDim2.new(0, 26, 0, 26),
    Position = UDim2.new(0, 556, 0, 4),
    Name = "RemoveBtn",
    Parent = TopBar
})

local Close = CreateImageButton({
    Image = "rbxassetid://118026365011536",
    Size = UDim2.new(0, 26, 0, 26),
    Name = "Close",
    Position = UDim2.new(0, 519, 0, 4),
    Parent = TopBar
})

local Title = Instance.new("TextLabel")
Title.TextWrapped = true
Title.BorderSizePixel = 0
Title.TextSize = 12
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(0, 104, 0, 26)
Title.Text = "Lucide"
Title.Position = UDim2.new(0, 49, 0, 3)
Title.TextColor3 = Color3.fromRGB(226, 226, 226)
Title.Parent = TopBar

local IconTop = Instance.new("ImageLabel")
IconTop.BorderSizePixel = 0
IconTop.BackgroundTransparency = 1
IconTop.Image = "rbxassetid://121377864496432"
IconTop.Size = UDim2.new(0, 34, 0, 34)
IconTop.Position = UDim2.new(0, 6, 0, -1)
IconTop.Parent = TopBar

local Divider1 = Instance.new("Frame")
Divider1.BorderSizePixel = 0
Divider1.BackgroundColor3 = Color3.fromRGB(52, 52, 52)
Divider1.Size = UDim2.new(0, 602, 0, 2)
Divider1.Position = UDim2.new(0, 0, 0, 43)
Divider1.Parent = Lucide

local SearchBar = Instance.new("Frame")
SearchBar.BorderSizePixel = 0
SearchBar.BackgroundColor3 = Color3.fromRGB(46, 46, 46)
SearchBar.Size = UDim2.new(0, 208, 0, 28)
SearchBar.Position = UDim2.new(0, 185, 0, 7)
SearchBar.Parent = Lucide
AddCorner(SearchBar, UDim.new(0, 8))

local SearchBox = Instance.new("TextBox")
SearchBox.Name = "SearchBox"
SearchBox.TextXAlignment = Enum.TextXAlignment.Left
SearchBox.BorderSizePixel = 0
SearchBox.TextColor3 = Color3.fromRGB(230, 230, 230)
SearchBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
SearchBox.PlaceholderText = "Search by ID ..."
SearchBox.Size = UDim2.new(0, 166, 0, 22)
SearchBox.Position = UDim2.new(0, 36, 0, 3)
SearchBox.BackgroundTransparency = 1
SearchBox.Text = ""
SearchBox.TextSize = 14
SearchBox.Parent = SearchBar

local SearchIcon = Instance.new("ImageLabel")
SearchIcon.BorderSizePixel = 0
SearchIcon.BackgroundTransparency = 1
SearchIcon.Image = "rbxassetid://118685771787843"
SearchIcon.Size = UDim2.new(0, 23, 0, 23)
SearchIcon.Position = UDim2.new(0, 5, 0, 2)
SearchIcon.Parent = SearchBar

local Divider2 = Instance.new("Frame")
Divider2.BorderSizePixel = 0
Divider2.BackgroundColor3 = Color3.fromRGB(52, 52, 52)
Divider2.Size = UDim2.new(0, 3, 0, 233)
Divider2.Position = UDim2.new(0, 410, 0, 45)
Divider2.Parent = Lucide

local PreviewImage = Instance.new("ImageLabel")
PreviewImage.BorderSizePixel = 0
PreviewImage.BackgroundColor3 = Color3.fromRGB(92, 92, 92)
PreviewImage.Size = UDim2.new(0, 100, 0, 100)
PreviewImage.Position = UDim2.new(0, 427, 0, 58)
PreviewImage.BackgroundTransparency = 1
PreviewImage.Parent = Lucide
AddCorner(PreviewImage, UDim.new(0, 10))

local CopyID = CreateImageButton({
    Image = "rbxassetid://124735040937171",
    Size = UDim2.new(0, 46, 0, 46),
    Position = UDim2.new(0, 542, 0, 58),
    Visible = false,
    Parent = Lucide
})
AddCorner(CopyID, UDim.new(0, 8))

local IDLabel = Instance.new("TextLabel")
IDLabel.TextWrapped = true
IDLabel.BorderSizePixel = 0
IDLabel.TextScaled = true
IDLabel.BackgroundTransparency = 1
IDLabel.Size = UDim2.new(0, 168, 0, 30)
IDLabel.Position = UDim2.new(0, 424, 0, 179)
IDLabel.Text = ""
IDLabel.TextColor3 = Color3.fromRGB(97, 97, 97)
IDLabel.Parent = Lucide

local IconScroll = Instance.new("ScrollingFrame")
IconScroll.BorderSizePixel = 0
IconScroll.ElasticBehavior = Enum.ElasticBehavior.Never
IconScroll.VerticalScrollBarInset = Enum.ScrollBarInset.Always
IconScroll.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
IconScroll.Size = UDim2.new(0, 398, 0, 225)
IconScroll.Position = UDim2.new(0, 8, 0, 48)
IconScroll.ScrollBarThickness = 3
IconScroll.BackgroundTransparency = 1
IconScroll.Parent = Lucide

-- Virtualization Setup
local CELL_SIZE = 60
local CELL_PADDING = 6
local ITEMS_PER_ROW = 6
local BUFFER_ROWS = 4

local FilteredIcons = {}
local IconPool = {}
local ActiveCells = {}

local function GetAssetID(Asset)
    return Asset:match("%d+$") or ""
end

local function UpdateFilteredIcons(Query)
    FilteredIcons = {}
    
    if Query == "" then
        for I = 1, #LucideIcons do
            table.insert(FilteredIcons, {Index = I, Asset = LucideIcons[I], ID = GetAssetID(LucideIcons[I])})
        end
    else
        Query = Query:lower()
        for I = 1, #LucideIcons do
            local Asset = LucideIcons[I]
            local ID = GetAssetID(Asset)
            if ID:find(Query, 1, true) then
                table.insert(FilteredIcons, {Index = I, Asset = Asset, ID = ID})
            end
        end
    end
    
    local TotalRows = math.ceil(#FilteredIcons / ITEMS_PER_ROW)
    local ContentHeight = TotalRows * (CELL_SIZE + CELL_PADDING) + 20
    IconScroll.CanvasSize = UDim2.new(0, 0, 0, ContentHeight)
end

local function GetOrCreateCell()
    local Cell = table.remove(IconPool)
    
    if not Cell then
        local Holder = Instance.new("Frame")
        Holder.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        Holder.Size = UDim2.new(0, CELL_SIZE, 0, CELL_SIZE)
        Holder.BorderSizePixel = 0
        Holder.Parent = IconScroll
        AddCorner(Holder, UDim.new(0, 10))

        local ImgBtn = Instance.new("ImageButton")
        ImgBtn.Size = UDim2.new(0, 50, 0, 50)
        ImgBtn.Position = UDim2.new(0.5, -25, 0, 5)
        ImgBtn.BackgroundTransparency = 1
        ImgBtn.Parent = Holder
        ImgBtn.Name = "IconBtn"
        
        Cell = {Holder = Holder, Button = ImgBtn}
    end
    
    Cell.Holder.Parent = IconScroll
    return Cell
end

local function RecycleCell(Cell)
    Cell.Holder.Parent = nil
    table.insert(IconPool, Cell)
end

local function UpdateCell(Cell, IconData, Row, Col)
    local XPos = Col * (CELL_SIZE + CELL_PADDING)
    local YPos = Row * (CELL_SIZE + CELL_PADDING)
    
    Cell.Holder.Position = UDim2.new(0, XPos, 0, YPos)
    Cell.Button.Image = IconData.Asset
    
    if Cell.Connection then
        Cell.Connection:Disconnect()
    end
    
    Cell.Connection = Cell.Button.MouseButton1Click:Connect(function()
        PreviewImage.Image = IconData.Asset
        IDLabel.Text = IconData.ID
        CopyID.Visible = true
    end)
end

local function RenderVisibleIcons()
    local ScrollPos = IconScroll.CanvasPosition.Y
    local ViewportHeight = IconScroll.AbsoluteSize.Y
    
    local StartRow = math.max(0, math.floor(ScrollPos / (CELL_SIZE + CELL_PADDING)) - BUFFER_ROWS)
    local EndRow = math.ceil((ScrollPos + ViewportHeight) / (CELL_SIZE + CELL_PADDING)) + BUFFER_ROWS
    
    local NewActiveCells = {}
    
    for Row = StartRow, EndRow do
        for Col = 0, ITEMS_PER_ROW - 1 do
            local Index = Row * ITEMS_PER_ROW + Col + 1
            
            if Index <= #FilteredIcons then
                local Key = Row .. "_" .. Col
                local Cell = ActiveCells[Key]
                
                if not Cell then
                    Cell = GetOrCreateCell()
                    UpdateCell(Cell, FilteredIcons[Index], Row, Col)
                end
                
                NewActiveCells[Key] = Cell
            end
        end
    end
    
    for Key, Cell in pairs(ActiveCells) do
        if not NewActiveCells[Key] then
            RecycleCell(Cell)
        end
    end
    
    ActiveCells = NewActiveCells
end

UpdateFilteredIcons("")
RenderVisibleIcons()

local RenderConnection
RenderConnection = RunService.Heartbeat:Connect(function()
    if Lucide.Visible then
        RenderVisibleIcons()
    end
end)

IconScroll:GetPropertyChangedSignal("CanvasPosition"):Connect(RenderVisibleIcons)

local LastQuery = ""
local SearchDebounce
SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
    if SearchDebounce then
        task.cancel(SearchDebounce)
    end
    SearchDebounce = task.delay(0.15, function()
        local Query = SearchBox.Text
        if Query ~= LastQuery then
            LastQuery = Query
            
            for _, Cell in pairs(ActiveCells) do
                RecycleCell(Cell)
            end
            ActiveCells = {}
            
            UpdateFilteredIcons(Query)
            RenderVisibleIcons()
        end
    end)
end)

CopyID.MouseButton1Click:Connect(function()
    local Text = IDLabel.Text
    if Text ~= "" then
        pcall(setclipboard, Text)
    end
end)

local TweenInfo = TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local OriginalSize = Lucide.Size
local OriginalPosition = Lucide.Position

local function CloseGUI()
    TweenService:Create(Lucide, TweenInfo, {Size = UDim2.new(0, 0, 0, 0)}):Play()
    task.delay(0.12, function()
        Lucide.Visible = false
        Open.Visible = true
    end)
end

local function OpenGUI()
    Lucide.Size = UDim2.new(0, 0, 0, 0)
    Lucide.Position = OriginalPosition
    Lucide.Visible = true
    TweenService:Create(Lucide, TweenInfo, {Size = OriginalSize}):Play()
    task.delay(0.12, function()
        Open.Visible = false
    end)
end

Close.MouseButton1Click:Connect(CloseGUI)
Open.MouseButton1Click:Connect(OpenGUI)
RemoveBtn.MouseButton1Click:Connect(function()
    if RenderConnection then
        RenderConnection:Disconnect()
    end
    ScreenGui:Destroy()
end)