local GetRef = (type(cloneref) == 'function') and cloneref or function(x)
    return x
end

local InputService = GetRef(game:GetService('UserInputService'))
local Tween = GetRef(game:GetService('TweenService'))
local TextService = GetRef(game:GetService('TextService'))

local Create = Instance.new
local UDim2New = UDim2.new
local UDimNew = UDim.new
local Vec2 = Vector2.new
local RGB = Color3.fromRGB

-- Simplified tween creation
local function CreateTween(obj, duration, props)
    return Tween:Create(obj, TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
end

local Colors = {
    Primary = RGB(100, 100, 100),
    Dark = RGB(22, 22, 26),
    Accent = RGB(138, 43, 226),
    White = RGB(255, 255, 255),
    LightGray = RGB(245, 245, 245),
    MediumGray = RGB(200, 200, 200),
    DarkGray = RGB(150, 150, 150),
    Background = RGB(24, 24, 26),
    Outline = RGB(30, 30, 30),
    Topbar = RGB(10, 10, 10),
    Selection = RGB(138, 43, 226),
}

local Icons = {
    Menu = 'rbxassetid://82682091622365',
    Minimize = 'rbxassetid://101118075751604',
    Arrow = 'rbxassetid://10709790948',
}

-- Helper function to create instances
local function CreateElement(className, props)
    local element = Create(className)
    for prop, value in pairs(props) do
        if prop ~= 'Parent' then
            element[prop] = value
        end
    end
    if props.Parent then
        element.Parent = props.Parent
    end
    return element
end

-- Remove existing instances
local ExistingHub = gethui():FindFirstChild('NexusLibrary')
local ExistingMenu = gethui():FindFirstChild('NexusLibraryMenuButton')

if ExistingHub then ExistingHub:Destroy() end
if ExistingMenu then ExistingMenu:Destroy() end

-- Helper functions
local function AddCorner(parent, radius)
    return CreateElement('UICorner', {
        Parent = parent,
        CornerRadius = UDimNew(0, radius)
    })
end

local function MakeDraggable(dragHandle, targetFrame, connections)
    local Dragging, DragInput, DragStart, StartPos
    
    connections[#connections + 1] = dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPos = targetFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)
    
    connections[#connections + 1] = InputService.InputChanged:Connect(function(input)
        if Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local Delta = input.Position - DragStart
            targetFrame.Position = UDim2New(
                StartPos.X.Scale, StartPos.X.Offset + Delta.X,
                StartPos.Y.Scale, StartPos.Y.Offset + Delta.Y
            )
        end
    end)
end

-- Create menu button
local MenuGui = CreateElement('ScreenGui', {
    Name = 'NexusLibraryMenuButton',
    Parent = gethui(),
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    ResetOnSpawn = false,
    Enabled = false
})

local MenuOutline = CreateElement('Frame', {
    Name = 'OutlineButton',
    Parent = MenuGui,
    BackgroundColor3 = Colors.Dark,
    Position = UDim2New(0, 10, 0, 10),
    Size = UDim2New(0, 50, 0, 50)
})
AddCorner(MenuOutline, 12)

local MenuBtn = CreateElement('ImageButton', {
    Parent = MenuOutline,
    Position = UDim2New(0.5, 0, 0.5, 0),
    Size = UDim2New(0, 40, 0, 40),
    AnchorPoint = Vec2(0.5, 0.5),
    BackgroundColor3 = Colors.Dark,
    ImageColor3 = Colors.White,
    Image = Icons.Menu
})
AddCorner(MenuBtn, 10)

local MenuConnections = {}
MakeDraggable(MenuBtn, MenuOutline, MenuConnections)

-- Library
local Library = {}

function Library:CreateWindow(title)
    title = title or 'NEXUS LIBRARY'
    
    local WindowSize = UDim2New(0, 490, 0, 330)
    local TabWidth = 130
    local Window = {}
    local FirstTab = false
    local Connections = {}
    
    local MainGui = CreateElement('ScreenGui', {
        Name = 'NexusLibrary',
        Parent = gethui(),
        DisplayOrder = 999,
        ResetOnSpawn = false
    })
    
    Window._Connections = Connections
    
    -- Main frame
    local MainFrame = CreateElement('Frame', {
        Name = 'MainFrame',
        Parent = MainGui,
        AnchorPoint = Vec2(0.5, 0.5),
        BackgroundColor3 = Colors.Background,
        Position = UDim2New(0.5, 0, 0.45, 0),
        Size = UDim2New(0, 0, 0, 0)
    })
    MainFrame:TweenSize(WindowSize, 'Out', 'Quad', 0.4, true)
    AddCorner(MainFrame, 12)
    
    -- Top bar
    local TopBar = CreateElement('Frame', {
        Name = 'TopBar',
        Parent = MainFrame,
        BackgroundColor3 = Colors.Topbar,
        Size = UDim2New(1, 0, 0, 40)
    })
    AddCorner(TopBar, 5)
    
    -- Title
    local Title = CreateElement('TextLabel', {
        Name = 'TitleLabel',
        Parent = TopBar,
        BackgroundTransparency = 1,
        Position = UDim2New(0, 15, 0.5, 0),
        AnchorPoint = Vec2(0, 0.5),
        Font = Enum.Font.Cartoon,
        Text = title,
        TextSize = 20,
        TextColor3 = Colors.White,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local TitleSize = TextService:GetTextSize(Title.Text, Title.TextSize, Title.Font, Vec2(9999, 9999))
    Title.Size = UDim2New(0, TitleSize.X, 0, 25)
    
    -- Minimize button
    local MinBtn = CreateElement('ImageButton', {
        Name = 'MinimizeBtn',
        Parent = TopBar,
        BackgroundTransparency = 1,
        AnchorPoint = Vec2(1, 0.5),
        Position = UDim2New(1, -15, 0.5, 0),
        Size = UDim2New(0, 20, 0, 20),
        Image = Icons.Minimize,
        ImageColor3 = Colors.LightGray
    })
    AddCorner(MinBtn, 3)
    
    -- Tab container
    local TabContainer = CreateElement('Frame', {
        Name = 'TabContainer',
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2New(0, 8, 0, TopBar.Size.Y.Offset),
        Size = UDim2New(0, TabWidth, WindowSize.Y.Scale, WindowSize.Y.Offset - TopBar.Size.Y.Offset - 8)
    })
    
    local TabScroll = CreateElement('ScrollingFrame', {
        Name = 'TabScrollFrame',
        Parent = TabContainer,
        BackgroundTransparency = 1,
        Size = UDim2New(1, 0, 1, 0),
        ScrollBarThickness = 0
    })
    AddCorner(TabContainer, 5)
    
    CreateElement('UIListLayout', {
        Parent = TabScroll,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDimNew(0, 2)
    })
    
    -- Content frame
    local ContentFrame = CreateElement('Frame', {
        Name = 'ContentPage',
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2New(0, TabContainer.Size.X.Offset + 18, 0, TopBar.Size.Y.Offset),
        Size = UDim2New(
            WindowSize.X.Scale, WindowSize.X.Offset - TabContainer.Size.X.Offset - 25,
            WindowSize.Y.Scale, WindowSize.Y.Offset - TopBar.Size.Y.Offset - 8
        )
    })
    AddCorner(ContentFrame, 3)
    
    -- Page container
    local PageContainer = CreateElement('Frame', {
        Name = 'PageContainer',
        Parent = ContentFrame,
        BackgroundTransparency = 1,
        ClipsDescendants = true,
        Size = UDim2New(1, 0, 1, 0)
    })
    
    local PageFolder = CreateElement('Folder', {
        Name = 'PageList',
        Parent = PageContainer
    })
    
    CreateElement('UIPageLayout', {
        Parent = PageFolder,
        SortOrder = Enum.SortOrder.LayoutOrder,
        EasingDirection = Enum.EasingDirection.InOut,
        EasingStyle = Enum.EasingStyle.Quad,
        Padding = UDimNew(0, 10),
        TweenTime = 0
    })
    
    -- Make draggable
    MakeDraggable(TopBar, MainFrame, Connections)
    
    -- Button connections
    Connections[#Connections + 1] = MinBtn.MouseButton1Click:Connect(function()
        MainGui.Enabled = false
        MenuGui.Enabled = true
    end)
    
    MenuBtn.MouseButton1Click:Connect(function()
        MainGui.Enabled = true
        MenuGui.Enabled = false
    end)
    
    -- Tab creation function
    function Window:CreateTab(name)
        local TabBtn = CreateElement('TextButton', {
            Name = name .. 'Tab',
            Parent = TabScroll,
            Text = '',
            BackgroundTransparency = 1,
            Size = UDim2New(1, 0, 0, 35)
        })
        
        local Indicator = CreateElement('Frame', {
            Name = 'SelectionIndicator',
            Parent = TabBtn,
            BackgroundColor3 = Colors.Accent,
            Size = UDim2New(0, 3, 0, 0),
            Position = UDim2New(0, 0, 0.5, 0),
            AnchorPoint = Vec2(0, 0.5)
        })
        AddCorner(Indicator, 100)
        
        local TabLabel = CreateElement('TextLabel', {
            Name = 'TabText',
            Parent = TabBtn,
            BackgroundTransparency = 1,
            Position = UDim2New(0, 10, 0.5, 0),
            Size = UDim2New(0, 100, 0, 30),
            Font = Enum.Font.Cartoon,
            Text = name,
            AnchorPoint = Vec2(0, 0.5),
            TextColor3 = Colors.White,
            TextTransparency = 0.4,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        AddCorner(TabBtn, 6)
        
        -- Create page for this tab
        local PageScroll = CreateElement('ScrollingFrame', {
            Name = name .. 'Page',
            Parent = PageFolder,
            BackgroundTransparency = 1,
            Size = UDim2New(1, 0, 1, 0),
            ScrollBarThickness = 0
        })
        
        local PageList = CreateElement('UIListLayout', {
            Parent = PageScroll,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDimNew(0, 3)
        })
        
        Connections[#Connections + 1] = PageList:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(function()
            PageScroll.CanvasSize = UDim2New(0, 0, 0, PageList.AbsoluteContentSize.Y + 5)
        end)
        
        -- Tab selection
        Connections[#Connections + 1] = TabBtn.MouseButton1Click:Connect(function()
            -- Deselect all tabs
            for _, tab in ipairs(TabScroll:GetChildren()) do
                if tab:IsA('TextButton') then
                    CreateTween(tab, 0.3, {BackgroundTransparency = 1}):Play()
                    
                    local indicator = tab:FindFirstChild('SelectionIndicator')
                    if indicator then
                        CreateTween(indicator, 0.2, {Size = UDim2New(0, 3, 0, 0)}):Play()
                    end
                    
                    local label = tab:FindFirstChild('TabText')
                    if label then
                        CreateTween(label, 0.3, {TextTransparency = 0.4}):Play()
                    end
                end
            end
            
            -- Select this tab
            CreateTween(TabBtn, 0.3, {BackgroundTransparency = 0.8}):Play()
            CreateTween(Indicator, 0.3, {Size = UDim2New(0, 3, 0, 15)}):Play()
            CreateTween(TabLabel, 0.3, {TextTransparency = 0}):Play()
            PageFolder.UIPageLayout:JumpTo(PageScroll)
        end)
        
        -- Select first tab
        if not FirstTab then
            TabBtn.BackgroundTransparency = 0.8
            Indicator.Size = UDim2New(0, 3, 0, 15)
            TabLabel.TextTransparency = 0
            PageFolder.UIPageLayout:JumpToIndex(1)
            FirstTab = true
        end
        
        local Tab = {}
        
        -- Button
        function Tab:AddButton(text, callback)
            local Button = CreateElement('TextButton', {
                Name = 'Button',
                Parent = PageScroll,
                BackgroundColor3 = Colors.Accent,
                Size = UDim2New(1, 0, 0, 36),
                Text = ''
            })
            AddCorner(Button, 5)
            
            CreateElement('TextLabel', {
                Name = 'ButtonText',
                Parent = Button,
                BackgroundTransparency = 1,
                AnchorPoint = Vec2(0.5, 0.5),
                Position = UDim2New(0.5, 0, 0.5, 0),
                Size = UDim2New(1, -20, 1, 0),
                Font = Enum.Font.Cartoon,
                Text = text,
                TextColor3 = Colors.White,
                TextSize = 15
            })
            
            Connections[#Connections + 1] = Button.MouseButton1Click:Connect(function()
                pcall(callback)
            end)
        end
        
        -- Toggle
        function Tab:AddToggle(text, defaultValue, callback)
            local IsToggled = defaultValue or false
            
            local ToggleBtn = CreateElement('TextButton', {
                Name = 'ToggleButton',
                Parent = PageScroll,
                BackgroundColor3 = Colors.Primary,
                BackgroundTransparency = 0.8,
                Text = '',
                Size = UDim2New(1, 0, 0, 36)
            })
            AddCorner(ToggleBtn, 5)
            
            CreateElement('TextLabel', {
                Parent = ToggleBtn,
                BackgroundTransparency = 1,
                Size = UDim2New(1, 0, 0, 35),
                Font = Enum.Font.Cartoon,
                Text = text,
                TextColor3 = Colors.White,
                TextSize = 15,
                TextXAlignment = Enum.TextXAlignment.Left,
                AnchorPoint = Vec2(0, 0.5),
                Position = UDim2New(0, 15, 0.5, 0)
            })
            
            local ToggleFrame = CreateElement('Frame', {
                Name = 'ToggleFrame',
                Parent = ToggleBtn,
                BackgroundTransparency = 1,
                Position = UDim2New(1, -10, 0.5, 0),
                Size = UDim2New(0, 35, 0, 20),
                AnchorPoint = Vec2(1, 0.5)
            })
            
            local ToggleBg = CreateElement('TextButton', {
                Name = 'ToggleBackground',
                Parent = ToggleFrame,
                BackgroundColor3 = Colors.MediumGray,
                BackgroundTransparency = 0.8,
                Size = UDim2New(1, 0, 1, 0),
                Text = ''
            })
            AddCorner(ToggleBg, 10)
            
            local ToggleCircle = CreateElement('Frame', {
                Name = 'ToggleCircle',
                Parent = ToggleBg,
                BackgroundColor3 = Colors.White,
                Position = UDim2New(0, 3, 0.5, 0),
                Size = UDim2New(0, 14, 0, 14),
                AnchorPoint = Vec2(0, 0.5)
            })
            AddCorner(ToggleCircle, 10)
            
            local function UpdateToggle(state)
                if state then
                    ToggleCircle:TweenPosition(UDim2New(0, 17, 0.5, 0), 'Out', 'Sine', 0.2, true)
                    CreateTween(ToggleBg, 0.4, {
                        BackgroundColor3 = Colors.Accent,
                        BackgroundTransparency = 0
                    }):Play()
                else
                    ToggleCircle:TweenPosition(UDim2New(0, 4, 0.5, 0), 'Out', 'Sine', 0.2, true)
                    CreateTween(ToggleBg, 0.4, {
                        BackgroundColor3 = Colors.MediumGray,
                        BackgroundTransparency = 0.8
                    }):Play()
                end
            end
            
            Connections[#Connections + 1] = ToggleBg.MouseButton1Click:Connect(function()
                IsToggled = not IsToggled
                UpdateToggle(IsToggled)
                pcall(callback, IsToggled)
            end)
            
            if defaultValue then
                UpdateToggle(true)
            end
            
            local Toggle = {Value = IsToggled}
            
            function Toggle:SetValue(newValue)
                IsToggled = newValue
                self.Value = IsToggled
                UpdateToggle(IsToggled)
                pcall(callback, IsToggled)
            end
            
            return Toggle
        end
        
        -- Dropdown
        function Tab:AddDropdown(text, defaultValue, options, callback)
            local IsOpen = false
            local Selected = nil
            
            -- Handle optional parameter order
            if type(options) == 'function' then
                callback = options
                options = defaultValue
                defaultValue = nil
            end
            
            local DropFrame = CreateElement('Frame', {
                Name = 'Dropdown',
                Parent = PageScroll,
                BackgroundColor3 = Colors.Primary,
                BackgroundTransparency = 0.8,
                Size = UDim2New(1, 0, 0, 36)
            })
            AddCorner(DropFrame, 5)
            
            local TopSection = CreateElement('Frame', {
                Name = 'TopSection',
                Parent = DropFrame,
                BackgroundTransparency = 1,
                Size = UDim2New(1, 0, 0, 36)
            })
            
            local DropLabel = CreateElement('TextLabel', {
                Name = 'DropdownTitle',
                Parent = TopSection,
                BackgroundTransparency = 1,
                Position = UDim2New(0, 15, 0.5, 0),
                Size = UDim2New(0, 150, 0, 36),
                Font = Enum.Font.Cartoon,
                Text = text .. ' - ',
                AnchorPoint = Vec2(0, 0.5),
                TextColor3 = Colors.White,
                TextSize = 15,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local SelectedLabel = CreateElement('TextLabel', {
                Name = 'SelectedLabel',
                Parent = TopSection,
                BackgroundTransparency = 1,
                Position = UDim2New(0, 15, 0.5, 0),
                Size = UDim2New(0.6, 0, 0, 36),
                AnchorPoint = Vec2(0, 0.5),
                Font = Enum.Font.Cartoon,
                TextSize = 15,
                TextColor3 = Colors.White,
                TextTransparency = 0.6,
                Text = 'None',
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Arrow = CreateElement('ImageLabel', {
                Name = 'ArrowIcon',
                Parent = TopSection,
                BackgroundTransparency = 1,
                AnchorPoint = Vec2(1, 0.5),
                Position = UDim2New(1, -10, 0.5, 0),
                Size = UDim2New(0, 20, 0, 20),
                Image = Icons.Arrow,
                ImageColor3 = Colors.White
            })
            
            local DropContainer = CreateElement('Frame', {
                Name = 'DropdownScrollContainer',
                Parent = DropFrame,
                BackgroundColor3 = Colors.Background,
                Size = UDim2New(1, -10, 0, 0),
                Position = UDim2New(0, 5, 0, 36),
                Visible = false
            })
            AddCorner(DropContainer, 5)
            
            local DropScroll = CreateElement('ScrollingFrame', {
                Name = 'DropdownScroll',
                Parent = DropContainer,
                BackgroundTransparency = 1,
                Position = UDim2New(0, 0, 0, 10),
                Size = UDim2New(1, 0, 1, -15),
                ScrollBarThickness = 0
            })
            
            local DropList = CreateElement('UIListLayout', {
                Parent = DropScroll,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDimNew(0, 1)
            })
            
            local function UpdateText()
                if Selected and Selected ~= "" then
                    local titleText = text .. ' - '
                    local titleSize = TextService:GetTextSize(titleText, 15, Enum.Font.Cartoon, Vec2(9999, 9999))
                    
                    DropLabel.Text = titleText
                    DropLabel.Size = UDim2New(0, titleSize.X, 0, 36)
                    SelectedLabel.Text = Selected
                    SelectedLabel.Position = UDim2New(0, 15 + titleSize.X, 0.5, 0)
                    SelectedLabel.TextTransparency = 0
                else
                    DropLabel.Text = text .. ' - '
                    SelectedLabel.Text = 'None'
                    SelectedLabel.TextTransparency = 0.6
                    
                    local titleText = text .. ' - '
                    local titleSize = TextService:GetTextSize(titleText, 15, Enum.Font.Cartoon, Vec2(9999, 9999))
                    DropLabel.Size = UDim2New(0, titleSize.X, 0, 36)
                    SelectedLabel.Position = UDim2New(0, 15 + titleSize.X, 0.5, 0)
                end
            end
            
            local function UpdateVisuals()
                for _, btn in ipairs(DropScroll:GetChildren()) do
                    if btn:IsA('TextButton') then
                        local isSelected = Selected == btn.Text
                        btn.BackgroundTransparency = isSelected and 0.5 or 1
                        btn.TextTransparency = isSelected and 0 or 0.5
                    end
                end
            end
            
            local function AddOption(optionText)
                local OptionBtn = CreateElement('TextButton', {
                    Name = 'Option',
                    Parent = DropScroll,
                    BackgroundColor3 = Colors.Primary,
                    BackgroundTransparency = 1,
                    Size = UDim2New(1, 0, 0, 30),
                    Font = Enum.Font.Cartoon,
                    Text = tostring(optionText),
                    TextColor3 = Colors.White,
                    TextSize = 13,
                    TextTransparency = 0.5,
                    TextXAlignment = Enum.TextXAlignment.Center
                })
                AddCorner(OptionBtn, 5)
                
                Connections[#Connections + 1] = OptionBtn.MouseButton1Click:Connect(function()
                    Selected = OptionBtn.Text
                    UpdateVisuals()
                    UpdateText()
                    pcall(callback, Selected)
                end)
            end
            
            if defaultValue ~= nil and defaultValue ~= "" then
                Selected = tostring(defaultValue)
            end
            
            if type(options) == 'table' then
                for i = 1, #options do
                    AddOption(tostring(options[i]))
                end
            else
                warn('Dropdown: options parameter must be a table')
                options = {}
            end
            
            UpdateText()
            UpdateVisuals()
            
            local function Toggle()
                IsOpen = not IsOpen
                local targetSize = IsOpen and UDim2New(1, 0, 0, 150) or UDim2New(1, 0, 0, 36)
                local containerSize = IsOpen and UDim2New(1, -10, 0, 110) or UDim2New(1, -10, 0, 0)
                local rotation = IsOpen and 180 or 0
                
                CreateTween(DropFrame, 0.3, {Size = targetSize}):Play()
                CreateTween(DropContainer, 0.3, {Size = containerSize}):Play()
                CreateTween(Arrow, 0.3, {Rotation = rotation}):Play()
                DropContainer.Visible = IsOpen
            end
            
            local ClickArea = CreateElement('TextButton', {
                Name = 'DropdownClickArea',
                Parent = TopSection,
                BackgroundTransparency = 1,
                Size = UDim2New(1, 0, 0, 36),
                Text = ''
            })
            
            Connections[#Connections + 1] = ClickArea.MouseButton1Click:Connect(Toggle)
            Connections[#Connections + 1] = DropList:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(function()
                DropScroll.CanvasSize = UDim2New(0, 0, 0, DropList.AbsoluteContentSize.Y + 10)
            end)
            
            local Dropdown = {}
            
            function Dropdown:Add(option)
                AddOption(tostring(option))
                UpdateVisuals()
            end
            
            function Dropdown:Clear()
                Selected = nil
                UpdateText()
                
                for _, child in ipairs(DropScroll:GetChildren()) do
                    if child:IsA('TextButton') then
                        child:Destroy()
                    end
                end
            end
            
            return Dropdown
        end
        
        -- Slider
        function Tab:AddSlider(text, minValue, maxValue, defaultValue, increment, callback)
            increment = tonumber(increment) or 1
            minValue = tonumber(minValue) or 0
            maxValue = tonumber(maxValue) or 100
            defaultValue = math.clamp(tonumber(defaultValue) or minValue, minValue, maxValue)
            
            local function RoundValue(value)
                return math.floor(value / increment + 0.5) * increment
            end
            
            local SliderFrame = CreateElement('Frame', {
                Name = 'Slider',
                Parent = PageScroll,
                BackgroundTransparency = 1,
                Size = UDim2New(1, 0, 0, 40)
            })
            AddCorner(SliderFrame, 5)
            
            local SliderBg = CreateElement('Frame', {
                Name = 'SliderBackground',
                Parent = SliderFrame,
                BackgroundColor3 = Colors.Primary,
                BackgroundTransparency = 0.8,
                Size = UDim2New(1, 0, 0, 40)
            })
            AddCorner(SliderBg, 5)
            
            CreateElement('TextLabel', {
                Parent = SliderBg,
                BackgroundTransparency = 1,
                Position = UDim2New(0, 15, 0.5, 0),
                Size = UDim2New(0.5, 0, 0, 30),
                Font = Enum.Font.Cartoon,
                Text = text,
                AnchorPoint = Vec2(0, 0.5),
                TextColor3 = Colors.White,
                TextSize = 15,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local SliderBar = CreateElement('Frame', {
                Name = 'SliderBar',
                Parent = SliderBg,
                BackgroundColor3 = Colors.MediumGray,
                Size = UDim2New(0, 150, 0, 8),
                Position = UDim2New(1, -10, 0.5, 0),
                BackgroundTransparency = 0.8,
                AnchorPoint = Vec2(1, 0.5)
            })
            AddCorner(SliderBar, 4)
            
            local SliderFill = CreateElement('Frame', {
                Name = 'SliderFill',
                Parent = SliderBar,
                BackgroundColor3 = Colors.Accent
            })
            AddCorner(SliderFill, 4)
            
            local ValueLabel = CreateElement('TextLabel', {
                Parent = SliderBg,
                BackgroundTransparency = 1,
                Position = UDim2New(1, -170, 0.5, 0),
                Size = UDim2New(0, 50, 0, 30),
                Font = Enum.Font.Cartoon,
                AnchorPoint = Vec2(1, 0.5),
                TextColor3 = Colors.White,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Right
            })
            
            local CurrentValue = RoundValue(defaultValue)
            local InitialPercent = (CurrentValue - minValue) / (maxValue - minValue)
            SliderFill.Size = UDim2New(0, InitialPercent * 150, 0, 8)
            ValueLabel.Text = tostring(CurrentValue)
            
            local IsDragging = false
            local PendingValue = CurrentValue
            
            local function UpdateSlider(input)
                local barPos = SliderBar.AbsolutePosition.X
                local barSize = SliderBar.AbsoluteSize.X
                local mouseX = input.Position.X
                local percent = math.clamp((mouseX - barPos) / barSize, 0, 1)
                local rawValue = minValue + (maxValue - minValue) * percent
                
                PendingValue = RoundValue(rawValue)
                ValueLabel.Text = tostring(PendingValue)
                SliderFill.Size = UDim2New(0, percent * 150, 0, 8)
            end
            
            Connections[#Connections + 1] = SliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = true
                    UpdateSlider(input)
                end
            end)
            
            Connections[#Connections + 1] = InputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    if IsDragging then
                        IsDragging = false
                        CurrentValue = PendingValue
                        pcall(callback, CurrentValue)
                    end
                end
            end)
            
            Connections[#Connections + 1] = InputService.InputChanged:Connect(function(input)
                if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    UpdateSlider(input)
                end
            end)
            
            local Slider = {Value = CurrentValue}
            
            function Slider:SetValue(newValue)
                local rawValue = tonumber(newValue) or CurrentValue
                local clampedValue = math.clamp(rawValue, minValue, maxValue)
                local roundedValue = RoundValue(clampedValue)
                local percent = (roundedValue - minValue) / (maxValue - minValue)
                
                CurrentValue = roundedValue
                PendingValue = roundedValue
                self.Value = roundedValue
                ValueLabel.Text = tostring(roundedValue)
                SliderFill.Size = UDim2New(0, percent * 150, 0, 8)
                pcall(callback, roundedValue)
            end
            
            return Slider
        end
        
        -- Textbox
        function Tab:AddTextbox(text, placeholder, callback)
            placeholder = placeholder or 'Enter text...'
            
            local TextboxFrame = CreateElement('Frame', {
                Name = 'Textbox',
                Parent = PageScroll,
                BackgroundColor3 = Colors.Primary,
                BackgroundTransparency = 0.8,
                Size = UDim2New(1, 0, 0, 36)
            })
            AddCorner(TextboxFrame, 5)
            
            CreateElement('TextLabel', {
                Name = 'TextboxLabel',
                Parent = TextboxFrame,
                BackgroundTransparency = 1,
                Position = UDim2New(0, 15, 0.5, 0),
                Text = text,
                Size = UDim2New(0.6, 0, 0, 36),
                Font = Enum.Font.Cartoon,
                AnchorPoint = Vec2(0, 0.5),
                TextColor3 = Colors.White,
                TextSize = 15,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local InputBox = CreateElement('TextBox', {
                Name = 'InputBox',
                Parent = TextboxFrame,
                BackgroundColor3 = Colors.Background,
                BackgroundTransparency = 0,
                Position = UDim2New(1, -5, 0.5, 0),
                AnchorPoint = Vec2(1, 0.5),
                Size = UDim2New(0, 80, 0, 25),
                Font = Enum.Font.Cartoon,
                PlaceholderText = placeholder,
                PlaceholderColor3 = Colors.DarkGray,
                Text = '',
                TextColor3 = Colors.LightGray,
                TextSize = 11
            })
            AddCorner(InputBox, 5)
            
            Connections[#Connections + 1] = InputBox.FocusLost:Connect(function()
                pcall(callback, InputBox.Text)
            end)
        end
        
        -- Label
        function Tab:AddLabel(text)
            local LabelFrame = CreateElement('Frame', {
                Name = 'LabelFrame',
                Parent = PageScroll,
                BackgroundColor3 = Colors.Primary,
                BackgroundTransparency = 0.8,
                Size = UDim2New(1, 0, 0, 36)
            })
            AddCorner(LabelFrame, 5)
            
            local LabelText = CreateElement('TextLabel', {
                Name = 'LabelText',
                Parent = LabelFrame,
                BackgroundTransparency = 1,
                Size = UDim2New(1, -20, 1, 0),
                Font = Enum.Font.Cartoon,
                Position = UDim2New(0, 10, 0, 0),
                TextColor3 = Colors.LightGray,
                TextSize = 15,
                Text = text,
                TextWrapped = true
            })
            
            local Label = {}
            
            function Label:SetText(newText)
                LabelText.Text = newText
            end
            
            return Label
        end
        
        return Tab
    end
    
    return Window
end

return Library