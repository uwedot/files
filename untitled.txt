local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")

local NEW = Instance.new
local UDIM2 = UDim2.new
local UDIM = UDim.new
local VEC2 = Vector2.new
local C3RGB = Color3.fromRGB

local QuickTween = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local MediumTween = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local SlowTween = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

local Color = {
    Primary = C3RGB(100, 100, 100),
    Dark = C3RGB(22, 22, 26),
    Third = C3RGB(138, 43, 226),
    White = C3RGB(255, 255, 255),
    LightGray = C3RGB(245, 245, 245),
    MediumGray = C3RGB(200, 200, 200),
    DarkGray = C3RGB(150, 150, 150),
    Background = C3RGB(24, 24, 26),
    Outline = C3RGB(30, 30, 30),
    Topbar = C3RGB(10, 10, 10),
    Selection = C3RGB(138, 43, 226)
}

local Assets = {
    MenuIcon = "rbxassetid://86862177543059",
    CloseIcon = "rbxassetid://7743878857",
    MaximizeIcon = "rbxassetid://10734886735",
    RestoreIcon = "rbxassetid://10734895698",
    DropdownArrow = "rbxassetid://10709790948"
}

local existingHub = CoreGui:FindFirstChild("DzHub")
local existingMenu = CoreGui:FindFirstChild("DzHubMenuButton")
if existingHub then existingHub:Destroy() end
if existingMenu then existingMenu:Destroy() end

local function CreateRounded(parent, radius)
    local rounded = NEW("UICorner")
    rounded.CornerRadius = UDIM(0, radius)
    rounded.Parent = parent
    return rounded
end

local function MakeDraggable(topbarObject, object, connections)
    local dragging, dragInput, dragStart, startPosition
    
    local function update(input)
        local delta = input.Position - dragStart
        object.Position = UDIM2(
            startPosition.X.Scale, startPosition.X.Offset + delta.X,
            startPosition.Y.Scale, startPosition.Y.Offset + delta.Y
        )
    end
    
    local conn1 = topbarObject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPosition = object.Position
            
            local conn = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    
    local conn2 = topbarObject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    local conn3 = UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then update(input) end
    end)
    
    if connections then
        connections[#connections + 1] = conn1
        connections[#connections + 1] = conn2
        connections[#connections + 1] = conn3
    end
end

local MenuButtonGui = NEW("ScreenGui")
MenuButtonGui.Name = "DzHubMenuButton"
MenuButtonGui.Parent = CoreGui
MenuButtonGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
MenuButtonGui.ResetOnSpawn = false

local OutlineButton = NEW("Frame")
OutlineButton.Name = "OutlineButton"
OutlineButton.Parent = MenuButtonGui
OutlineButton.ClipsDescendants = true
OutlineButton.BackgroundColor3 = Color.Dark
OutlineButton.Position = UDIM2(0, 10, 0, 10)
OutlineButton.Size = UDIM2(0, 50, 0, 50)
CreateRounded(OutlineButton, 12)

local MenuButton = NEW("ImageButton")
MenuButton.Parent = OutlineButton
MenuButton.Position = UDIM2(0.5, 0, 0.5, 0)
MenuButton.Size = UDIM2(0, 40, 0, 40)
MenuButton.AnchorPoint = VEC2(0.5, 0.5)
MenuButton.BackgroundColor3 = Color.Dark
MenuButton.ImageColor3 = Color.White
MenuButton.Image = Assets.MenuIcon
MenuButton.AutoButtonColor = false
CreateRounded(MenuButton, 10)

local MenuButtonConnections = {}
MakeDraggable(MenuButton, OutlineButton, MenuButtonConnections)

MenuButton.MouseButton1Click:Connect(function()
    local dzHub = CoreGui:FindFirstChild("DzHub")
    if dzHub then dzHub.Enabled = not dzHub.Enabled end
end)

local Library = {}

function Library:Window(config)
    assert(config.SubTitle, "SubTitle is required")
    assert(config.Size, "Size is required")
    assert(config.TabWidth, "TabWidth is required")
    
    local WindowConfig = { Size = config.Size, TabWidth = config.TabWidth }
    local UiTab = {}
    local FirstTabCreated = false
    local CurrentPage = ""
    local Connections = {}
    
    local MainGui = NEW("ScreenGui")
    MainGui.Name = "DzHub"
    MainGui.Parent = CoreGui
    MainGui.DisplayOrder = 999
    MainGui.ResetOnSpawn = false
    
    UiTab._ScrollTab = nil
    UiTab._MainGui = MainGui
    UiTab._Connections = Connections
    
    local MainFrame = NEW("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = MainGui
    MainFrame.ClipsDescendants = true
    MainFrame.AnchorPoint = VEC2(0.5, 0.5)
    MainFrame.BackgroundColor3 = Color.Background
    MainFrame.Position = UDIM2(0.5, 0, 0.45, 0)
    MainFrame.Size = UDIM2(0, 0, 0, 0)
    MainFrame:TweenSize(WindowConfig.Size, "Out", "Quad", 0.4, true)
    CreateRounded(MainFrame, 12)
    
    local ResizeHandle = NEW("Frame")
    ResizeHandle.Name = "ResizeHandle"
    ResizeHandle.Parent = MainFrame
    ResizeHandle.Position = UDIM2(1, 5, 1, 5)
    ResizeHandle.AnchorPoint = VEC2(1, 1)
    ResizeHandle.Size = UDIM2(0, 15, 0, 15)
    ResizeHandle.BackgroundColor3 = Color.Primary
    ResizeHandle.BackgroundTransparency = 1
    ResizeHandle.ZIndex = 10
    CreateRounded(ResizeHandle, 99)
    
    local TopBar = NEW("Frame")
    TopBar.Name = "TopBar"
    TopBar.Parent = MainFrame
    TopBar.BackgroundColor3 = Color.Topbar
    TopBar.Size = UDIM2(1, 0, 0, 40)
    TopBar.BackgroundTransparency = 1
    CreateRounded(TopBar, 5)
    
    local TitleLabel = NEW("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Parent = TopBar
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.RichText = true
    TitleLabel.Position = UDIM2(0, 15, 0.5, 0)
    TitleLabel.AnchorPoint = VEC2(0, 0.5)
    TitleLabel.Size = UDIM2(0, 1, 0, 25)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.Text = "DZ HUB"
    TitleLabel.TextSize = 20
    TitleLabel.TextColor3 = Color.White
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    local TitleSize = TextService:GetTextSize(TitleLabel.Text, TitleLabel.TextSize, TitleLabel.Font, VEC2(9999, 9999))
    TitleLabel.Size = UDIM2(0, TitleSize.X, 0, 25)
    
    local SubTitleLabel = NEW("TextLabel")
    SubTitleLabel.Name = "SubTitleLabel"
    SubTitleLabel.Parent = TitleLabel
    SubTitleLabel.BackgroundTransparency = 1
    SubTitleLabel.Position = UDIM2(0, TitleSize.X + 8, 0.5, 0)
    SubTitleLabel.Size = UDIM2(0, 1, 0, 20)
    SubTitleLabel.Font = Enum.Font.Cartoon
    SubTitleLabel.AnchorPoint = VEC2(0, 0.5)
    SubTitleLabel.Text = config.SubTitle
    SubTitleLabel.TextSize = 15
    SubTitleLabel.TextColor3 = Color.DarkGray
    
    local SubtitleSize = TextService:GetTextSize(SubTitleLabel.Text, SubTitleLabel.TextSize, SubTitleLabel.Font, VEC2(9999, 9999))
    SubTitleLabel.Size = UDIM2(0, SubtitleSize.X, 0, 25)
    
    local CloseBtn = NEW("ImageButton")
    CloseBtn.Name = "CloseBtn"
    CloseBtn.Parent = TopBar
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.AnchorPoint = VEC2(1, 0.5)
    CloseBtn.Position = UDIM2(1, -15, 0.5, 0)
    CloseBtn.Size = UDIM2(0, 20, 0, 20)
    CloseBtn.Image = Assets.CloseIcon
    CloseBtn.ImageColor3 = Color.LightGray
    CreateRounded(CloseBtn, 3)
    
    CloseBtn.MouseButton1Click:Connect(function()
        for i = 1, #Connections do Connections[i]:Disconnect() end
        if MainGui.Parent then MainGui:Destroy() end
        if MenuButtonGui.Parent then MenuButtonGui:Destroy() end
    end)
    
    local MaximizeBtn = NEW("ImageButton")
    MaximizeBtn.Name = "MaximizeBtn"
    MaximizeBtn.Parent = TopBar
    MaximizeBtn.BackgroundTransparency = 1
    MaximizeBtn.AnchorPoint = VEC2(1, 0.5)
    MaximizeBtn.Position = UDIM2(1, -50, 0.5, 0)
    MaximizeBtn.Size = UDIM2(0, 20, 0, 20)
    MaximizeBtn.Image = Assets.MaximizeIcon
    MaximizeBtn.ImageColor3 = Color.LightGray
    CreateRounded(MaximizeBtn, 3)
    
    local TabContainer = NEW("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.Parent = MainFrame
    TabContainer.BackgroundTransparency = 1
    TabContainer.Position = UDIM2(0, 8, 0, TopBar.Size.Y.Offset)
    TabContainer.Size = UDIM2(0, WindowConfig.TabWidth, config.Size.Y.Scale, config.Size.Y.Offset - TopBar.Size.Y.Offset - 8)
    
    local TabScrollFrame = NEW("ScrollingFrame")
    TabScrollFrame.Name = "TabScrollFrame"
    TabScrollFrame.Parent = TabContainer
    TabScrollFrame.Active = true
    TabScrollFrame.BackgroundTransparency = 1
    TabScrollFrame.Size = UDIM2(1, 0, 1, 0)
    TabScrollFrame.ScrollBarThickness = 0
    TabScrollFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    
    CreateRounded(TabContainer, 5)
    UiTab._ScrollTab = TabScrollFrame
    
    local TabListLayout = NEW("UIListLayout")
    TabListLayout.Parent = TabScrollFrame
    TabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabListLayout.Padding = UDIM(0, 2)
    
    local TabPadding = NEW("UIPadding")
    TabPadding.Parent = TabScrollFrame
    
    local ContentPage = NEW("Frame")
    ContentPage.Name = "ContentPage"
    ContentPage.Parent = MainFrame
    ContentPage.BackgroundColor3 = Color.Dark
    ContentPage.Position = UDIM2(0, TabContainer.Size.X.Offset + 18, 0, TopBar.Size.Y.Offset)
    ContentPage.Size = UDIM2(
        config.Size.X.Scale, config.Size.X.Offset - TabContainer.Size.X.Offset - 25,
        config.Size.Y.Scale, config.Size.Y.Offset - TopBar.Size.Y.Offset - 8
    )
    ContentPage.BackgroundTransparency = 1
    CreateRounded(ContentPage, 3)
    
    local PageContainer = NEW("Frame")
    PageContainer.Name = "PageContainer"
    PageContainer.Parent = ContentPage
    PageContainer.ClipsDescendants = true
    PageContainer.BackgroundTransparency = 1
    PageContainer.Size = UDIM2(1, 0, 1, 0)
    
    local PageList = NEW("Folder")
    PageList.Name = "PageList"
    PageList.Parent = PageContainer
    
    local PageLayout = NEW("UIPageLayout")
    PageLayout.Parent = PageList
    PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    PageLayout.EasingDirection = Enum.EasingDirection.InOut
    PageLayout.EasingStyle = Enum.EasingStyle.Quad
    PageLayout.FillDirection = Enum.FillDirection.Vertical
    PageLayout.Padding = UDIM(0, 10)
    PageLayout.TweenTime = 0
    PageLayout.GamepadInputEnabled = false
    PageLayout.ScrollWheelInputEnabled = false
    PageLayout.TouchInputEnabled = false
    
    MakeDraggable(TopBar, MainFrame, Connections)
    
    local KeybindDebounce = false
    Connections[#Connections + 1] = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed or KeybindDebounce then return end
        if input.KeyCode == Enum.KeyCode.LeftControl then
            KeybindDebounce = true
            local dzHub = CoreGui:FindFirstChild("DzHub")
            if dzHub then dzHub.Enabled = not dzHub.Enabled end
            task.delay(0.2, function() KeybindDebounce = false end)
        end
    end)
    
    local Resizing = false
    
    Connections[#Connections + 1] = ResizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Resizing = true
        end
    end)
    
    Connections[#Connections + 1] = UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Resizing = false
        end
    end)
    
    Connections[#Connections + 1] = UserInputService.InputChanged:Connect(function(input)
        if Resizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local viewport = workspace.CurrentCamera.ViewportSize
            local maxWidth = viewport.X * 0.8
            local maxHeight = viewport.Y * 0.8
            
            local newWidth = math.clamp(input.Position.X - MainFrame.AbsolutePosition.X, WindowConfig.Size.X.Offset, maxWidth)
            local newHeight = math.clamp(input.Position.Y - MainFrame.AbsolutePosition.Y, WindowConfig.Size.Y.Offset, maxHeight)
            
            MainFrame.Size = UDIM2(0, newWidth, 0, newHeight)
            ContentPage.Size = UDIM2(0, newWidth - TabContainer.Size.X.Offset - 25, 0, newHeight - TopBar.Size.Y.Offset - 10)
            TabContainer.Size = UDIM2(0, WindowConfig.TabWidth, 0, newHeight - TopBar.Size.Y.Offset - 10)
        end
    end)
    
    Connections[#Connections + 1] = TabListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        TabScrollFrame.CanvasSize = UDIM2(0, 0, 0, TabListLayout.AbsoluteContentSize.Y)
    end)
    
    function UiTab:Tab(text)
        local TabBtn = NEW("TextButton")
        TabBtn.Parent = TabScrollFrame
        TabBtn.Name = text .. "Tab"
        TabBtn.Text = ""
        TabBtn.BackgroundTransparency = 1
        TabBtn.Size = UDIM2(1, 0, 0, 35)
        TabBtn.Font = Enum.Font.Nunito
        TabBtn.TextColor3 = Color.White
        TabBtn.TextSize = 12
        TabBtn.TextTransparency = 0.9
        
        local SelectionIndicator = NEW("Frame")
        SelectionIndicator.Name = "SelectionIndicator"
        SelectionIndicator.Parent = TabBtn
        SelectionIndicator.BackgroundColor3 = Color.Third
        SelectionIndicator.Size = UDIM2(0, 3, 0, 0)
        SelectionIndicator.Position = UDIM2(0, 0, 0.5, 0)
        SelectionIndicator.AnchorPoint = VEC2(0, 0.5)
        CreateRounded(SelectionIndicator, 100)
        
        local TabText = NEW("TextLabel")
        TabText.Parent = TabBtn
        TabText.Name = "TabText"
        TabText.BackgroundTransparency = 1
        TabText.Position = UDIM2(0, 10, 0.5, 0)
        TabText.Size = UDIM2(0, 100, 0, 30)
        TabText.Font = Enum.Font.Roboto
        TabText.Text = text
        TabText.AnchorPoint = VEC2(0, 0.5)
        TabText.TextColor3 = Color.White
        TabText.TextTransparency = 0.4
        TabText.TextSize = 14
        TabText.TextXAlignment = Enum.TextXAlignment.Left
        
        CreateRounded(TabBtn, 6)
        
        local PageFrame = NEW("ScrollingFrame")
        PageFrame.Name = text .. "Page"
        PageFrame.Parent = PageList
        PageFrame.Active = true
        PageFrame.BackgroundTransparency = 1
        PageFrame.Size = UDIM2(1, 0, 1, 0)
        PageFrame.ScrollBarThickness = 0
        PageFrame.ScrollingDirection = Enum.ScrollingDirection.Y
        
        local PagePadding = NEW("UIPadding")
        PagePadding.Parent = PageFrame
        
        local PageListLayout = NEW("UIListLayout")
        PageListLayout.Parent = PageFrame
        PageListLayout.SortOrder = Enum.SortOrder.LayoutOrder
        PageListLayout.Padding = UDIM(0, 3)
        
        Connections[#Connections + 1] = PageListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            PageFrame.CanvasSize = UDIM2(0, 0, 0, PageListLayout.AbsoluteContentSize.Y)
        end)
        
                    Connections[#Connections + 1] = TabBtn.MouseButton1Click:Connect(function()
            local children = TabScrollFrame:GetChildren()
            for i = 1, #children do
                local v = children[i]
                if v:IsA("TextButton") then
                    TweenService:Create(v, MediumTween, {BackgroundTransparency = 1}):Play()
                    local indicator = v:FindFirstChild("SelectionIndicator")
                    if indicator then
                        TweenService:Create(indicator, QuickTween, {Size = UDIM2(0, 3, 0, 0)}):Play()
                    end
                    local txt = v:FindFirstChild("TabText")
                    if txt then
                        TweenService:Create(txt, MediumTween, {TextTransparency = 0.4}):Play()
                    end
                end
            end
            
            TweenService:Create(TabBtn, MediumTween, {BackgroundTransparency = 0.8}):Play()
            TweenService:Create(SelectionIndicator, MediumTween, {Size = UDIM2(0, 3, 0, 15)}):Play()
            TweenService:Create(TabText, MediumTween, {TextTransparency = 0}):Play()
            
            CurrentPage = text .. "Page"
            PageLayout:JumpTo(PageFrame)
        end)
        
        if not FirstTabCreated then
            TweenService:Create(TabBtn, MediumTween, {BackgroundTransparency = 0.8}):Play()
            TweenService:Create(SelectionIndicator, QuickTween, {Size = UDIM2(0, 3, 0, 15)}):Play()
            TweenService:Create(TabText, MediumTween, {TextTransparency = 0}):Play()
            PageLayout:JumpToIndex(1)
            FirstTabCreated = true
        end
        
        local DefaultSize = true
        Connections[#Connections + 1] = MaximizeBtn.MouseButton1Click:Connect(function()
            if DefaultSize then
                DefaultSize = false
                MainFrame:TweenPosition(UDIM2(0.5, 0, 0.45, 0), "Out", "Quad", 0.2, true)
                MainFrame:TweenSize(UDIM2(1, 0, 1, 0), "Out", "Quad", 0.4, true, function()
                    local mainSize = MainFrame.AbsoluteSize
                    local tabSize = TabContainer.AbsoluteSize
                    local topSize = TopBar.AbsoluteSize
                    ContentPage:TweenSize(UDIM2(0, mainSize.X - tabSize.X - 25, 0, mainSize.Y - topSize.Y - 10), "Out", "Quad", 0.4, true)
                    TabContainer:TweenSize(UDIM2(0, WindowConfig.TabWidth, 0, mainSize.Y - topSize.Y - 10), "Out", "Quad", 0.4, true)
                end)
                MaximizeBtn.Image = Assets.RestoreIcon
            else
                DefaultSize = true
                MainFrame:TweenSize(UDIM2(0, WindowConfig.Size.X.Offset, 0, WindowConfig.Size.Y.Offset), "Out", "Quad", 0.4, true, function()
                    local mainSize = MainFrame.AbsoluteSize
                    local tabSize = TabContainer.AbsoluteSize
                    local topSize = TopBar.AbsoluteSize
                    ContentPage:TweenSize(UDIM2(0, mainSize.X - tabSize.X - 25, 0, mainSize.Y - topSize.Y - 10), "Out", "Quad", 0.4, true)
                    TabContainer:TweenSize(UDIM2(0, WindowConfig.TabWidth, 0, mainSize.Y - topSize.Y - 10), "Out", "Quad", 0.4, true)
                end)
                MaximizeBtn.Image = Assets.MaximizeIcon
            end
        end)
        
        local Page = {}
        
        function Page:Button(text, callback)
            local Btn = NEW("TextButton")
            Btn.Name = "Button"
            Btn.Parent = PageFrame
            Btn.BackgroundColor3 = Color.Third
            Btn.BackgroundTransparency = 0
            Btn.Size = UDIM2(1, 0, 0, 36)
            Btn.AutoButtonColor = false
            Btn.Text = ""
            CreateRounded(Btn, 5)
            
            local BtnText = NEW("TextLabel")
            BtnText.Name = "ButtonText"
            BtnText.Parent = Btn
            BtnText.BackgroundTransparency = 1
            BtnText.AnchorPoint = VEC2(0.5, 0.5)
            BtnText.Position = UDIM2(0.5, 0, 0.5, 0)
            BtnText.Size = UDIM2(1, -20, 1, 0)
            BtnText.Font = Enum.Font.Cartoon
            BtnText.RichText = true
            BtnText.Text = text
            BtnText.TextXAlignment = Enum.TextXAlignment.Center
            BtnText.TextYAlignment = Enum.TextYAlignment.Center
            BtnText.TextColor3 = Color.White
            BtnText.TextSize = 15
            
            Connections[#Connections + 1] = Btn.MouseButton1Click:Connect(function() pcall(callback) end)
        end
        
        function Page:Toggle(text, defaultValue, callback)
            local Toggled = defaultValue or false
            
            local ToggleBtn = NEW("TextButton")
            ToggleBtn.Name = "ToggleButton"
            ToggleBtn.Parent = PageFrame
            ToggleBtn.BackgroundColor3 = Color.Primary
            ToggleBtn.BackgroundTransparency = 0.8
            ToggleBtn.AutoButtonColor = false
            ToggleBtn.Text = ""
            ToggleBtn.Size = UDIM2(1, 0, 0, 36)
            CreateRounded(ToggleBtn, 5)
            
            local ToggleTitle = NEW("TextLabel")
            ToggleTitle.Parent = ToggleBtn
            ToggleTitle.BackgroundTransparency = 1
            ToggleTitle.Size = UDIM2(1, 0, 0, 35)
            ToggleTitle.Font = Enum.Font.Cartoon
            ToggleTitle.Text = text
            ToggleTitle.TextColor3 = Color.White
            ToggleTitle.TextSize = 15
            ToggleTitle.TextXAlignment = Enum.TextXAlignment.Left
            ToggleTitle.AnchorPoint = VEC2(0, 0.5)
            ToggleTitle.Position = UDIM2(0, 15, 0.5, 0)
            
            local ToggleFrame = NEW("Frame")
            ToggleFrame.Name = "ToggleFrame"
            ToggleFrame.Parent = ToggleBtn
            ToggleFrame.BackgroundTransparency = 1
            ToggleFrame.Position = UDIM2(1, -10, 0.5, 0)
            ToggleFrame.Size = UDIM2(0, 35, 0, 20)
            ToggleFrame.AnchorPoint = VEC2(1, 0.5)
            CreateRounded(ToggleFrame, 10)
            
            local ToggleBackground = NEW("TextButton")
            ToggleBackground.Name = "ToggleBackground"
            ToggleBackground.Parent = ToggleFrame
            ToggleBackground.BackgroundColor3 = Color.MediumGray
            ToggleBackground.BackgroundTransparency = 0.8
            ToggleBackground.Size = UDIM2(1, 0, 1, 0)
            ToggleBackground.Text = ""
            ToggleBackground.AutoButtonColor = false
            CreateRounded(ToggleBackground, 10)
            
            local ToggleCircle = NEW("Frame")
            ToggleCircle.Name = "ToggleCircle"
            ToggleCircle.Parent = ToggleBackground
            ToggleCircle.BackgroundColor3 = Color.White
            ToggleCircle.Position = UDIM2(0, 3, 0.5, 0)
            ToggleCircle.Size = UDIM2(0, 14, 0, 14)
            ToggleCircle.AnchorPoint = VEC2(0, 0.5)
            CreateRounded(ToggleCircle, 10)
            
            Connections[#Connections + 1] = ToggleBackground.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                if Toggled then
                    ToggleCircle:TweenPosition(UDIM2(0, 17, 0.5, 0), "Out", "Sine", 0.2, true)
                    TweenService:Create(ToggleBackground, SlowTween, {BackgroundColor3 = Color.Third, BackgroundTransparency = 0}):Play()
                else
                    ToggleCircle:TweenPosition(UDIM2(0, 4, 0.5, 0), "Out", "Sine", 0.2, true)
                    TweenService:Create(ToggleBackground, SlowTween, {BackgroundColor3 = Color.MediumGray, BackgroundTransparency = 0.8}):Play()
                end
                pcall(callback, Toggled)
            end)
            
            if defaultValue then
                Toggled = true
                ToggleCircle:TweenPosition(UDIM2(0, 17, 0.5, 0), "Out", "Sine", 0.4, true)
                TweenService:Create(ToggleBackground, SlowTween, {BackgroundColor3 = Color.Third, BackgroundTransparency = 0}):Play()
                pcall(callback, Toggled)
            end
            
            local ToggleFunc = { Value = Toggled }
            
            function ToggleFunc:Set(newValue)
                Toggled = newValue
                self.Value = Toggled
                if Toggled then
                    ToggleCircle:TweenPosition(UDIM2(0, 17, 0.5, 0), "Out", "Sine", 0.2, true)
                    TweenService:Create(ToggleBackground, SlowTween, {BackgroundColor3 = Color.Third, BackgroundTransparency = 0}):Play()
                else
                    ToggleCircle:TweenPosition(UDIM2(0, 4, 0.5, 0), "Out", "Sine", 0.2, true)
                    TweenService:Create(ToggleBackground, SlowTween, {BackgroundColor3 = Color.MediumGray, BackgroundTransparency = 0.8}):Play()
                end
                pcall(callback, Toggled)
            end
            
            return ToggleFunc
        end
        
        function Page:Dropdown(text, options, defaultValue, callback, isMultiSelect)
            local IsMulti = isMultiSelect == true
            local IsOpen = false
            local SelectedItems = {}
            local ActiveItem = nil
            
            local DropdownFrame = NEW("Frame")
            DropdownFrame.Name = "Dropdown"
            DropdownFrame.Parent = PageFrame
            DropdownFrame.BackgroundColor3 = Color.Primary
            DropdownFrame.BackgroundTransparency = 0.8
            DropdownFrame.ClipsDescendants = true
            DropdownFrame.Size = UDIM2(1, 0, 0, 40)
            CreateRounded(DropdownFrame, 5)
            
            local DropdownTitle = NEW("TextLabel")
            DropdownTitle.Name = "DropdownTitle"
            DropdownTitle.Parent = DropdownFrame
            DropdownTitle.BackgroundTransparency = 1
            DropdownTitle.Size = UDIM2(1, 0, 0, 30)
            DropdownTitle.Font = Enum.Font.Cartoon
            DropdownTitle.Text = text
            DropdownTitle.TextColor3 = Color.White
            DropdownTitle.TextSize = 15
            DropdownTitle.TextXAlignment = Enum.TextXAlignment.Left
            DropdownTitle.Position = UDIM2(0, 15, 0, 5)
            
            local SelectedLabel = NEW("TextButton")
            SelectedLabel.Name = "SelectedLabel"
            SelectedLabel.Parent = DropdownFrame
            SelectedLabel.BackgroundColor3 = Color.Background
            SelectedLabel.TextColor3 = Color.White
            SelectedLabel.Position = UDIM2(1, -5, 0, 5)
            SelectedLabel.Size = UDIM2(0, 100, 0, 30)
            SelectedLabel.AnchorPoint = VEC2(1, 0)
            SelectedLabel.Font = Enum.Font.GothamMedium
            SelectedLabel.AutoButtonColor = false
            SelectedLabel.TextSize = 9
            SelectedLabel.ZIndex = 1
            SelectedLabel.ClipsDescendants = true
            SelectedLabel.Text = "   Select Items"
            SelectedLabel.TextXAlignment = Enum.TextXAlignment.Left
            CreateRounded(SelectedLabel, 5)
            
            local ArrowIcon = NEW("ImageLabel")
            ArrowIcon.Name = "ArrowIcon"
            ArrowIcon.Parent = DropdownFrame
            ArrowIcon.BackgroundTransparency = 1
            ArrowIcon.AnchorPoint = VEC2(1, 0)
            ArrowIcon.Position = UDIM2(1, -110, 0, 10)
            ArrowIcon.Size = UDIM2(0, 20, 0, 20)
            ArrowIcon.Image = Assets.DropdownArrow
            ArrowIcon.ImageColor3 = Color.White
            
            local DropdownScrollContainer = NEW("Frame")
            DropdownScrollContainer.Name = "DropdownScrollContainer"
            DropdownScrollContainer.Parent = DropdownFrame
            DropdownScrollContainer.BackgroundColor3 = Color.Background
            DropdownScrollContainer.ClipsDescendants = true
            DropdownScrollContainer.Size = UDIM2(1, -10, 0, 0)
            DropdownScrollContainer.Position = UDIM2(0, 5, 0, 40)
            DropdownScrollContainer.Visible = false
            CreateRounded(DropdownScrollContainer, 5)
            
            local DropdownScroll = NEW("ScrollingFrame")
            DropdownScroll.Name = "DropdownScroll"
            DropdownScroll.Parent = DropdownScrollContainer
            DropdownScroll.Active = true
            DropdownScroll.BackgroundTransparency = 1
            DropdownScroll.Position = UDIM2(0, 0, 0, 10)
            DropdownScroll.Size = UDIM2(1, 0, 1, -15)
            DropdownScroll.ScrollBarThickness = 0
            DropdownScroll.ZIndex = 3
            DropdownScroll.CanvasSize = UDIM2(0, 0, 0, 0)
            
            local ScrollPadding = NEW("UIPadding")
            ScrollPadding.PaddingLeft = UDIM(0, 10)
            ScrollPadding.PaddingRight = UDIM(0, 10)
            ScrollPadding.Parent = DropdownScroll
            
            local DropdownLayout = NEW("UIListLayout")
            DropdownLayout.Parent = DropdownScroll
            DropdownLayout.SortOrder = Enum.SortOrder.LayoutOrder
            DropdownLayout.Padding = UDIM(0, 1)
            
            local function UpdateSelectedText()
                if not SelectedLabel.Parent then return end
                if IsMulti then
                    local count = 0
                    for _ in pairs(SelectedItems) do count = count + 1 end
                    if count == 0 then
                        SelectedLabel.Text = "   Select Items"
                    elseif count == 1 then
                        for item in pairs(SelectedItems) do
                            SelectedLabel.Text = "   " .. item
                            break
                        end
                    else
                        SelectedLabel.Text = "   " .. count .. " Selected"
                    end
                else
                    SelectedLabel.Text = ActiveItem and ("   " .. ActiveItem) or "   Select Items"
                end
            end
            
            local function UpdateItemsVisual()
                local children = DropdownScroll:GetChildren()
                for i = 1, #children do
                    local btn = children[i]
                    if btn:IsA("TextButton") then
                        local IsSelected = IsMulti and SelectedItems[btn.Text] or ActiveItem == btn.Text
                        btn.BackgroundTransparency = IsSelected and 0.5 or 1
                        btn.TextTransparency = IsSelected and 0 or 0.5
                    end
                end
            end
            
            local function CreateOption(optionText)
                local OptionBtn = NEW("TextButton")
                OptionBtn.Name = "Option"
                OptionBtn.Parent = DropdownScroll
                OptionBtn.BackgroundColor3 = Color.Primary
                OptionBtn.BackgroundTransparency = 1
                OptionBtn.Size = UDIM2(1, 0, 0, 30)
                OptionBtn.Font = Enum.Font.Nunito
                OptionBtn.Text = tostring(optionText)
                OptionBtn.TextColor3 = Color.White
                OptionBtn.TextSize = 13
                OptionBtn.TextTransparency = 0.5
                OptionBtn.TextXAlignment = Enum.TextXAlignment.Center
                OptionBtn.ZIndex = 4
                CreateRounded(OptionBtn, 5)
                
                Connections[#Connections + 1] = OptionBtn.MouseButton1Click:Connect(function()
                    if IsMulti then
                        SelectedItems[OptionBtn.Text] = not SelectedItems[OptionBtn.Text]
                        local SelectedArray = {}
                        for item in pairs(SelectedItems) do SelectedArray[#SelectedArray + 1] = item end
                        pcall(callback, SelectedArray)
                    else
                        ActiveItem = (ActiveItem == OptionBtn.Text) and nil or OptionBtn.Text
                        pcall(callback, ActiveItem)
                    end
                    UpdateItemsVisual()
                    UpdateSelectedText()
                end)
                
                return OptionBtn
            end
            
            if defaultValue then
                if IsMulti then
                    if type(defaultValue) == "table" then
                        for i = 1, #defaultValue do SelectedItems[tostring(defaultValue[i])] = true end
                    else
                        SelectedItems[tostring(defaultValue)] = true
                    end
                else
                    ActiveItem = tostring(defaultValue)
                end
            end
            
            for i = 1, #options do CreateOption(tostring(options[i])) end
            
            UpdateItemsVisual()
            UpdateSelectedText()
            
            local function ToggleDropdown()
                IsOpen = not IsOpen
                local targetSize = IsOpen and UDIM2(1, 0, 0, 145) or UDIM2(1, 0, 0, 40)
                local containerSize = IsOpen and UDIM2(1, -10, 0, 100) or UDIM2(1, -10, 0, 0)
                local rotation = IsOpen and 180 or 0
                
                TweenService:Create(DropdownFrame, MediumTween, {Size = targetSize}):Play()
                TweenService:Create(DropdownScrollContainer, MediumTween, {Size = containerSize}):Play()
                TweenService:Create(ArrowIcon, MediumTween, {Rotation = rotation}):Play()
                DropdownScrollContainer.Visible = IsOpen
            end
            
            local DropdownClickArea = NEW("TextButton")
            DropdownClickArea.Name = "DropdownClickArea"
            DropdownClickArea.Parent = DropdownFrame
            DropdownClickArea.BackgroundTransparency = 1
            DropdownClickArea.Size = UDIM2(1, 0, 0, 40)
            DropdownClickArea.Text = ""
            DropdownClickArea.ZIndex = 2
            DropdownClickArea.AutoButtonColor = false
            
            Connections[#Connections + 1] = DropdownClickArea.MouseButton1Click:Connect(ToggleDropdown)
            Connections[#Connections + 1] = SelectedLabel.MouseButton1Click:Connect(ToggleDropdown)
            Connections[#Connections + 1] = DropdownLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                DropdownScroll.CanvasSize = UDIM2(0, 0, 0, DropdownLayout.AbsoluteContentSize.Y + 10)
            end)
            
            local DropFunc = {}
            
            function DropFunc:Add(option) 
                CreateOption(tostring(option)) 
                UpdateItemsVisual() 
            end
            
            function DropFunc:Clear()
                if IsMulti then SelectedItems = {} else ActiveItem = nil end
                UpdateSelectedText()
                IsOpen = false
                DropdownScrollContainer.Visible = false
                local children = DropdownScroll:GetChildren()
                for i = 1, #children do
                    if children[i]:IsA("TextButton") then children[i]:Destroy() end
                end
            end
            
            function DropFunc:Refresh(newOptions)
                if type(newOptions) == "table" then
                    self:Clear()
                    for i = 1, #newOptions do self:Add(newOptions[i]) end
                end
            end
            
            function DropFunc:Set(newValue)
                if IsMulti then
                    SelectedItems = {}
                    if type(newValue) == "table" then
                        for i = 1, #newValue do SelectedItems[tostring(newValue[i])] = true end
                    elseif newValue then SelectedItems[tostring(newValue)] = true end
                    local arr = {}
                    for k in pairs(SelectedItems) do arr[#arr + 1] = k end
                    DropFunc.Value = arr
                    pcall(callback, arr)
                else
                    ActiveItem = newValue and tostring(newValue) or nil
                    DropFunc.Value = ActiveItem
                    pcall(callback, ActiveItem)
                end
                UpdateItemsVisual()
                UpdateSelectedText()
            end
            
            return DropFunc
        end
        
        function Page:Slider(text, minValue, maxValue, defaultValue, callback, decimalPlaces)
            local RoundingPlaces = decimalPlaces or 0
            minValue = tonumber(minValue) or 0
            maxValue = tonumber(maxValue) or 100
            defaultValue = math.clamp(tonumber(defaultValue) or minValue, minValue, maxValue)
            
            local function RoundValue(value)
                if RoundingPlaces == 0 then return math.floor(value + 0.5)
                else local multiplier = 10 ^ RoundingPlaces return math.floor(value * multiplier + 0.5) / multiplier end
            end
            
            local function FormatValue(value)
                if RoundingPlaces == 0 then return tostring(math.floor(value + 0.5))
                else return string.format("%." .. RoundingPlaces .. "f", RoundValue(value)) end
            end
            
            local SliderFrame = NEW("Frame")
            SliderFrame.Name = "Slider"
            SliderFrame.Parent = PageFrame
            SliderFrame.BackgroundTransparency = 1
            SliderFrame.Size = UDIM2(1, 0, 0, 40)
            CreateRounded(SliderFrame, 5)
            
            local SliderBackground = NEW("Frame")
            SliderBackground.Name = "SliderBackground"
            SliderBackground.Parent = SliderFrame
            SliderBackground.BackgroundColor3 = Color.Primary
            SliderBackground.BackgroundTransparency = 0.8
            SliderBackground.Size = UDIM2(1, 0, 0, 40)
            CreateRounded(SliderBackground, 5)
            
            local SliderTitle = NEW("TextLabel")
            SliderTitle.Parent = SliderBackground
            SliderTitle.BackgroundTransparency = 1
            SliderTitle.Position = UDIM2(0, 15, 0.5, 0)
            SliderTitle.Size = UDIM2(0.5, 0, 0, 30)
            SliderTitle.Font = Enum.Font.Cartoon
            SliderTitle.Text = text
            SliderTitle.AnchorPoint = VEC2(0, 0.5)
            SliderTitle.TextColor3 = Color.White
            SliderTitle.TextSize = 15
            SliderTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local SliderBar = NEW("Frame")
            SliderBar.Name = "SliderBar"
            SliderBar.Parent = SliderBackground
            SliderBar.BackgroundColor3 = Color.MediumGray
            SliderBar.Size = UDIM2(0, 150, 0, 8)
            SliderBar.Position = UDIM2(1, -10, 0.5, 0)
            SliderBar.BackgroundTransparency = 0.8
            SliderBar.AnchorPoint = VEC2(1, 0.5)
            CreateRounded(SliderBar, 4)
            
            local SliderFill = NEW("Frame")
            SliderFill.Name = "SliderFill"
            SliderFill.Parent = SliderBar
            SliderFill.BackgroundColor3 = Color.Third
            CreateRounded(SliderFill, 4)
            
            local ValueDisplay = NEW("TextLabel")
            ValueDisplay.Parent = SliderBackground
            ValueDisplay.BackgroundTransparency = 1
            ValueDisplay.Position = UDIM2(1, -170, 0.5, 0)
            ValueDisplay.Size = UDIM2(0, 50, 0, 30)
            ValueDisplay.Font = Enum.Font.GothamMedium
            ValueDisplay.AnchorPoint = VEC2(1, 0.5)
            ValueDisplay.TextColor3 = Color.White
            ValueDisplay.TextSize = 13
            ValueDisplay.TextXAlignment = Enum.TextXAlignment.Right
            
            local CurrentValue = RoundValue(defaultValue)
            local InitialPercentage = (CurrentValue - minValue) / (maxValue - minValue)
            SliderFill.Size = UDIM2(0, InitialPercentage * 150, 0, 8)
            ValueDisplay.Text = FormatValue(CurrentValue)
            
            local Dragging = false
            
            local function UpdateSlider(input)
                local barPosition = SliderBar.AbsolutePosition.X
                local barSize = SliderBar.AbsoluteSize.X
                local mouseX = input.Position.X
                local percentage = math.clamp((mouseX - barPosition) / barSize, 0, 1)
                local rawValue = minValue + (maxValue - minValue) * percentage
                CurrentValue = RoundValue(rawValue)
                ValueDisplay.Text = FormatValue(CurrentValue)
                SliderFill.Size = UDIM2(0, percentage * 150, 0, 8)
                pcall(callback, CurrentValue)
            end
            
            Connections[#Connections + 1] = SliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = true
                    UpdateSlider(input)
                end
            end)
            
            Connections[#Connections + 1] = UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = false
                end
            end)
            
            Connections[#Connections + 1] = UserInputService.InputChanged:Connect(function(input)
                if Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    UpdateSlider(input)
                end
            end)
            
            local SliderFunc = { Value = CurrentValue }
            
            function SliderFunc:Set(newValue)
                local rawValue = tonumber(newValue) or CurrentValue
                local clampedValue = math.clamp(rawValue, minValue, maxValue)
                local roundedValue = RoundValue(clampedValue)
                local percentage = (roundedValue - minValue) / (maxValue - minValue)
                CurrentValue = roundedValue
                self.Value = roundedValue
                ValueDisplay.Text = FormatValue(roundedValue)
                SliderFill.Size = UDIM2(0, percentage * 150, 0, 8)
                pcall(callback, roundedValue)
            end
            
            return SliderFunc
        end
        
        function Page:Textbox(text, callback)
            local TextboxFrame = NEW("Frame")
            TextboxFrame.Name = "Textbox"
            TextboxFrame.Parent = PageFrame
            TextboxFrame.BackgroundColor3 = Color.Primary
            TextboxFrame.BackgroundTransparency = 0.8
            TextboxFrame.Size = UDIM2(1, 0, 0, 36)
            CreateRounded(TextboxFrame, 5)
            
            local TextboxLabel = NEW("TextLabel")
            TextboxLabel.Name = "TextboxLabel"
            TextboxLabel.Parent = TextboxFrame
            TextboxLabel.BackgroundTransparency = 1
            TextboxLabel.Position = UDIM2(0, 15, 0.5, 0)
            TextboxLabel.Text = text
            TextboxLabel.Size = UDIM2(0.6, 0, 0, 36)
            TextboxLabel.Font = Enum.Font.Nunito
            TextboxLabel.AnchorPoint = VEC2(0, 0.5)
            TextboxLabel.TextColor3 = Color.White
            TextboxLabel.TextSize = 15
            TextboxLabel.TextXAlignment = Enum.TextXAlignment.Left
            
            local InputBox = NEW("TextBox")
            InputBox.Name = "InputBox"
            InputBox.Parent = TextboxFrame
            InputBox.BackgroundColor3 = Color.MediumGray
            InputBox.BackgroundTransparency = 0.8
            InputBox.Position = UDIM2(1, -5, 0.5, 0)
            InputBox.AnchorPoint = VEC2(1, 0.5)
            InputBox.Size = UDIM2(0, 80, 0, 25)
            InputBox.Font = Enum.Font.Gotham
            InputBox.Text = ""
            InputBox.TextColor3 = Color.LightGray
            InputBox.TextSize = 11
            InputBox.ClipsDescendants = true
            CreateRounded(InputBox, 5)
            
            Connections[#Connections + 1] = InputBox.FocusLost:Connect(function() pcall(callback, InputBox.Text) end)
        end
        
        function Page:Label(text)
            local TextSize = 15
            local MinHeight = 36
            
            local LabelFrame = NEW("Frame")
            LabelFrame.Name = "LabelFrame"
            LabelFrame.Parent = PageFrame
            LabelFrame.BackgroundColor3 = Color.Primary
            LabelFrame.BackgroundTransparency = 0.8
            LabelFrame.Size = UDIM2(1, 0, 0, MinHeight)
            CreateRounded(LabelFrame, 5)
            
            local LabelText = NEW("TextLabel")
            LabelText.Name = "LabelText"
            LabelText.Parent = LabelFrame
            LabelText.BackgroundTransparency = 1
            LabelText.Size = UDIM2(1, -20, 1, 0)
            LabelText.Font = Enum.Font.Nunito
            LabelText.Position = UDIM2(0, 10, 0, 0)
            LabelText.TextColor3 = Color.LightGray
            LabelText.TextSize = TextSize
            LabelText.RichText = true
            LabelText.Text = text
            LabelText.TextXAlignment = Enum.TextXAlignment.Left
            LabelText.TextYAlignment = Enum.TextYAlignment.Center
            LabelText.TextWrapped = true
            
            local LabelFunc = {}
            function LabelFunc:Set(newText)
                LabelText.Text = newText
                
                local textBounds = TextService:GetTextSize(
                    newText, 
                    TextSize, 
                    Enum.Font.Nunito, 
                    VEC2(LabelText.AbsoluteSize.X, math.huge)
                )
                
                if textBounds.Y > MinHeight then
                    local NewHeight = textBounds.Y + 10
                    LabelFrame.Size = UDIM2(1, 0, 0, NewHeight)
                else
                    LabelFrame.Size = UDIM2(1, 0, 0, MinHeight)
                end
            end
            return LabelFunc
        end
        
        return Page
    end
    
    return UiTab
end

return Library