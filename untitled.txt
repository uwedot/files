local CoreGui = cloneref(game:GetService("CoreGui"))
local TweenService = cloneref(game:GetService("TweenService"))
local UserInputService = cloneref(game:GetService("UserInputService"))
local RunService = cloneref(game:GetService("RunService"))

local Colors = {
	MainBackground = Color3.fromRGB(30, 30, 30),
	TopBar = Color3.fromRGB(24, 24, 24),
	TabsBackground = Color3.fromRGB(33, 33, 33),
	ElementBackground = Color3.fromRGB(35, 35, 35),
	ElementHover = Color3.fromRGB(40, 40, 40),
	Primary = Color3.fromRGB(17, 85, 232),
	PrimaryDark = Color3.fromRGB(10, 49, 134),
	PrimaryHover = Color3.fromRGB(12, 59, 160),
	SecondaryButton = Color3.fromRGB(14, 69, 188),
	TextPrimary = Color3.fromRGB(255, 255, 255),
	TextSecondary = Color3.fromRGB(72, 72, 72),
	TextPlaceholder = Color3.fromRGB(150, 150, 150),
	DarkElement = Color3.fromRGB(43, 43, 43),
	MediumElement = Color3.fromRGB(52, 52, 52),
	MinimizeIcon = Color3.fromRGB(199, 199, 199),
}

-- Optimization: Reusable TweenInfo objects
local TweenInfos = {
	Fast = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	Standard = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
	StandardIn = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
}

-- Optimization: Object pooling for tweens
local ActiveTweens = {}
local function SafeTween(obj, info, props)
	if ActiveTweens[obj] then
		ActiveTweens[obj]:Cancel()
	end
	local tween = TweenService:Create(obj, info, props)
	ActiveTweens[obj] = tween
	tween.Completed:Connect(function()
		if ActiveTweens[obj] == tween then
			ActiveTweens[obj] = nil
		end
	end)
	tween:Play()
	return tween
end

-- Optimization: Batched canvas size updates
local CanvasUpdateQueue = {}
local CanvasUpdateScheduled = false

local function ScheduleCanvasUpdate(list, container, padding)
	CanvasUpdateQueue[container] = {list = list, padding = padding or 0}
	
	if not CanvasUpdateScheduled then
		CanvasUpdateScheduled = true
		RunService.Heartbeat:Wait()
		
		for cont, data in pairs(CanvasUpdateQueue) do
			if cont.Parent then
				cont.CanvasSize = UDim2.new(0, 0, 0, data.list.AbsoluteContentSize.Y + data.padding)
			end
		end
		
		CanvasUpdateQueue = {}
		CanvasUpdateScheduled = false
	end
end

local Library = {}

function Library:Window(Title)
	local ExistingUI = CoreGui:FindFirstChild("SentinelLib")
	if ExistingUI then
		warn("Sentinel already exists! Destroying old instance and creating new one.")
		ExistingUI:Destroy()
	end

	local Ui = Instance.new("ScreenGui")
	Ui.Name = "SentinelLib"
	Ui.Parent = CoreGui
	Ui.ResetOnSpawn = false

	local Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Parent = Ui
	Main.BackgroundColor3 = Colors.MainBackground
	Main.BorderSizePixel = 0
	Main.Size = UDim2.new(0, 470, 0, 283)
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.Active = true

	local OldPosition = Main.Position
	local Dragging = false
	local DragInput, DragStart, StartPos

	-- Optimization: Throttled drag updates using Heartbeat
	local DragConnection
	local function UpdateInput(Input)
		local Delta = Input.Position - DragStart
		local NewPosition = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + Delta.X, StartPos.Y.Scale, StartPos.Y.Offset + Delta.Y)
		Main.Position = NewPosition
		OldPosition = NewPosition
	end

	Main.InputBegan:Connect(function(Input)
		if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = Input.Position
			StartPos = OldPosition
			
			if DragConnection then DragConnection:Disconnect() end
			DragConnection = RunService.Heartbeat:Connect(function()
				if Dragging and DragInput then
					UpdateInput(DragInput)
				end
			end)
			
			local ChangedConn
			ChangedConn = Input.Changed:Connect(function()
				if Input.UserInputState == Enum.UserInputState.End then
					Dragging = false
					if DragConnection then
						DragConnection:Disconnect()
						DragConnection = nil
					end
					ChangedConn:Disconnect()
				end
			end)
		end
	end)

	Main.InputChanged:Connect(function(Input)
		if Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch then
			DragInput = Input
		end
	end)

	local UiCorner = Instance.new("UICorner")
	UiCorner.CornerRadius = UDim.new(0, 6)
	UiCorner.Parent = Main

	local Shadow = Instance.new("ImageLabel")
	Shadow.Name = "Shadow"
	Shadow.Parent = Main
	Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
	Shadow.BackgroundTransparency = 1
	Shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	Shadow.Size = UDim2.new(1, 30, 1, 30)
	Shadow.ZIndex = 0
	Shadow.Image = "rbxassetid://5554236805"
	Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
	Shadow.ScaleType = Enum.ScaleType.Slice
	Shadow.SliceCenter = Rect.new(23, 23, 277, 277)

	local Top = Instance.new("Frame")
	Top.Name = "Top"
	Top.Parent = Main
	Top.BackgroundColor3 = Colors.TopBar
	Top.BorderSizePixel = 0
	Top.Size = UDim2.new(1, 0, 0, 34)

	local TopCorner = Instance.new("UICorner")
	TopCorner.CornerRadius = UDim.new(0, 6)
	TopCorner.Parent = Top

	local TopCover = Instance.new("Frame")
	TopCover.Name = "Cover"
	TopCover.Parent = Top
	TopCover.AnchorPoint = Vector2.new(0.5, 1)
	TopCover.BackgroundColor3 = Colors.TopBar
	TopCover.BorderSizePixel = 0
	TopCover.Position = UDim2.new(0.5, 0, 1, 0)
	TopCover.Size = UDim2.new(1, 0, 0, 4)

	local Line = Instance.new("Frame")
	Line.Name = "Line"
	Line.Parent = Top
	Line.AnchorPoint = Vector2.new(0.5, 1)
	Line.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Line.BackgroundTransparency = 0.92
	Line.Position = UDim2.new(0.5, 0, 1, 1)
	Line.Size = UDim2.new(1, 0, 0, 1)

	local Logo = Instance.new("ImageLabel")
	Logo.Name = "Logo"
	Logo.Parent = Top
	Logo.AnchorPoint = Vector2.new(0, 0.5)
	Logo.BackgroundTransparency = 1
	Logo.Position = UDim2.new(0, 4, 0.5, 0)
	Logo.Size = UDim2.new(0, 26, 0, 30)
	Logo.Image = "http://www.roblox.com/asset/?id=7803241868"
	Logo.ImageColor3 = Colors.Primary

	local Minimize = Instance.new("ImageButton")
	Minimize.Name = "Minimize"
	Minimize.Parent = Top
	Minimize.AnchorPoint = Vector2.new(1, 0.5)
	Minimize.BackgroundTransparency = 1
	Minimize.Position = UDim2.new(1, -6, 0.5, 0)
	Minimize.Size = UDim2.new(0, 20, 0, 20)
	Minimize.Image = "rbxassetid://121304296213645"
	Minimize.ImageColor3 = Colors.MinimizeIcon
	Minimize.ScaleType = Enum.ScaleType.Crop

	local MinimizedIcon = Instance.new("ImageButton")
	MinimizedIcon.Name = "MinimizedIcon"
	MinimizedIcon.Parent = Ui
	MinimizedIcon.AnchorPoint = Vector2.new(1, 0)
	MinimizedIcon.BackgroundColor3 = Colors.Primary
	MinimizedIcon.BorderSizePixel = 0
	MinimizedIcon.Position = UDim2.new(1, -20, 0, 20)
	MinimizedIcon.Size = UDim2.new(0, 40, 0, 40)
	MinimizedIcon.Visible = false
	MinimizedIcon.ZIndex = 10
	MinimizedIcon.Image = "rbxassetid://7803241868"

	local MinimizedIconCorner = Instance.new("UICorner")
	MinimizedIconCorner.CornerRadius = UDim.new(0, 8)
	MinimizedIconCorner.Parent = MinimizedIcon

	-- Optimization: Same drag optimization for minimized icon
	local MinDragging = false
	local MinDragInput, MinDragStart, MinStartPos
	local MinDragConnection

	local function UpdateMinInput(Input)
		local Delta = Input.Position - MinDragStart
		MinimizedIcon.Position = UDim2.new(MinStartPos.X.Scale, MinStartPos.X.Offset + Delta.X, MinStartPos.Y.Scale, MinStartPos.Y.Offset + Delta.Y)
	end

	MinimizedIcon.InputBegan:Connect(function(Input)
		if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
			MinDragging = true
			MinDragStart = Input.Position
			MinStartPos = MinimizedIcon.Position
			
			if MinDragConnection then MinDragConnection:Disconnect() end
			MinDragConnection = RunService.Heartbeat:Connect(function()
				if MinDragging and MinDragInput then
					UpdateMinInput(MinDragInput)
				end
			end)
			
			local ChangedConn
			ChangedConn = Input.Changed:Connect(function()
				if Input.UserInputState == Enum.UserInputState.End then
					MinDragging = false
					if MinDragConnection then
						MinDragConnection:Disconnect()
						MinDragConnection = nil
					end
					ChangedConn:Disconnect()
				end
			end)
		end
	end)

	MinimizedIcon.InputChanged:Connect(function(Input)
		if Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch then
			MinDragInput = Input
		end
	end)

	Minimize.MouseButton1Click:Connect(function()
		Main.Visible = false
		MinimizedIcon.Visible = true
	end)

	Minimize.MouseEnter:Connect(function()
		SafeTween(Minimize, TweenInfos.Standard, {ImageColor3 = Colors.TextPrimary})
	end)

	Minimize.MouseLeave:Connect(function()
		SafeTween(Minimize, TweenInfos.Standard, {ImageColor3 = Color3.fromRGB(166, 166, 166)})
	end)

	MinimizedIcon.MouseButton1Click:Connect(function()
		Main.Visible = true
		MinimizedIcon.Visible = false
	end)

	local GameName = Instance.new("TextLabel")
	GameName.Name = "GameName"
	GameName.Parent = Top
	GameName.AnchorPoint = Vector2.new(0, 0.5)
	GameName.BackgroundTransparency = 1
	GameName.Position = UDim2.new(0, 32, 0.5, 0)
	GameName.Size = UDim2.new(0, 165, 0, 22)
	GameName.Font = Enum.Font.Gotham
	GameName.Text = Title or "SentinelLib"
	GameName.TextColor3 = Colors.Primary
	GameName.TextSize = 14
	GameName.TextXAlignment = Enum.TextXAlignment.Left

	local Tabs = Instance.new("Frame")
	Tabs.Name = "Tabs"
	Tabs.Parent = Main
	Tabs.BackgroundColor3 = Colors.TabsBackground
	Tabs.BorderSizePixel = 0
	Tabs.Position = UDim2.new(0, 0, 0, 35)
	Tabs.Size = UDim2.new(0, 122, 1, -35)

	local TabsCorner = Instance.new("UICorner")
	TabsCorner.CornerRadius = UDim.new(0, 6)
	TabsCorner.Parent = Tabs

	local TabsCover = Instance.new("Frame")
	TabsCover.Name = "Cover"
	TabsCover.Parent = Tabs
	TabsCover.AnchorPoint = Vector2.new(1, 0.5)
	TabsCover.BackgroundColor3 = Colors.TabsBackground
	TabsCover.BorderSizePixel = 0
	TabsCover.Position = UDim2.new(1, 0, 0.5, 0)
	TabsCover.Size = UDim2.new(0, 5, 1, 0)

	local TabsContainer = Instance.new("ScrollingFrame")
	TabsContainer.Name = "TabsContainer"
	TabsContainer.Parent = Tabs
	TabsContainer.BackgroundTransparency = 1
	TabsContainer.Size = UDim2.new(1, 0, 1, 0)
	TabsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabsContainer.ScrollBarThickness = 0
	TabsContainer.ScrollBarImageTransparency = 1

	local TabsList = Instance.new("UIListLayout")
	TabsList.Name = "TabsList"
	TabsList.Parent = TabsContainer
	TabsList.HorizontalAlignment = Enum.HorizontalAlignment.Center
	TabsList.SortOrder = Enum.SortOrder.LayoutOrder
	TabsList.Padding = UDim.new(0, 5)

	local TabsPadding = Instance.new("UIPadding")
	TabsPadding.Parent = TabsContainer
	TabsPadding.PaddingTop = UDim.new(0, 5)

	-- Optimization: Batched canvas updates
	TabsList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		ScheduleCanvasUpdate(TabsList, TabsContainer, 10)
	end)

	local Pages = Instance.new("Frame")
	Pages.Name = "Pages"
	Pages.Parent = Main
	Pages.BackgroundColor3 = Colors.MainBackground
	Pages.BorderSizePixel = 0
	Pages.Position = UDim2.new(0, 130, 0, 42)
	Pages.Size = UDim2.new(1, -138, 1, -50)

	local PagesCorner = Instance.new("UICorner")
	PagesCorner.CornerRadius = UDim.new(0, 6)
	PagesCorner.Parent = Pages

	local TabFunctions = {}
	local FirstTabCreated = false

	function TabFunctions:Tab(TabTitle)
		local TitleText = TabTitle or "Tab"
		local TabButton = Instance.new("TextButton")
		TabButton.Name = "TabButton"
		TabButton.Parent = TabsContainer
		TabButton.BackgroundColor3 = Colors.Primary
		TabButton.BackgroundTransparency = 1
		TabButton.Size = UDim2.new(1, -12, 0, 30)
		TabButton.AutoButtonColor = false
		TabButton.Font = Enum.Font.Gotham
		TabButton.Text = ""
		TabButton.TextColor3 = Colors.TextSecondary
		TabButton.TextSize = 14

		local TabCorner = Instance.new("UICorner")
		TabCorner.CornerRadius = UDim.new(0, 6)
		TabCorner.Parent = TabButton

		local TextLabel = Instance.new("TextLabel")
		TextLabel.Name = "TextLabel"
		TextLabel.Parent = TabButton
		TextLabel.BackgroundTransparency = 1
		TextLabel.Size = UDim2.new(1, 0, 1, 0)
		TextLabel.Font = Enum.Font.Gotham
		TextLabel.Text = TitleText
		TextLabel.TextColor3 = Colors.TextSecondary
		TextLabel.TextSize = 14
		TextLabel.TextXAlignment = Enum.TextXAlignment.Center

		local Page = Instance.new("ScrollingFrame")
		Page.Name = "Page"
		Page.Visible = false
		Page.Parent = Pages
		Page.Active = true
		Page.BackgroundTransparency = 1
		Page.BorderSizePixel = 0
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.ScrollBarThickness = 0
		Page.ScrollBarImageTransparency = 1
		Page.ClipsDescendants = true

		local PageList = Instance.new("UIListLayout")
		PageList.Parent = Page
		PageList.HorizontalAlignment = Enum.HorizontalAlignment.Center
		PageList.SortOrder = Enum.SortOrder.LayoutOrder
		PageList.Padding = UDim.new(0, 6)

		local PagePadding = Instance.new("UIPadding")
		PagePadding.Parent = Page
		PagePadding.PaddingTop = UDim.new(0, 5)

		-- Optimization: Batched canvas updates
		PageList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			ScheduleCanvasUpdate(PageList, Page, 13)
		end)

		TabButton.MouseButton1Click:Connect(function()
			-- Optimization: Batch hide all pages
			for _, Child in next, Pages:GetChildren() do
				if Child:IsA("ScrollingFrame") then
					Child.Visible = false
				end
			end
			Page.Visible = true
			
			-- Optimization: Batch deselect all tabs
			for _, Child in next, TabsContainer:GetChildren() do
				if Child.Name == "TabButton" then
					SafeTween(Child, TweenInfos.Standard, {BackgroundTransparency = 1})
					if Child:FindFirstChild("TextLabel") then
						SafeTween(Child.TextLabel, TweenInfos.Standard, {TextColor3 = Colors.TextSecondary})
					end
				end
			end
			SafeTween(TabButton, TweenInfos.Standard, {BackgroundTransparency = 0.6})
			SafeTween(TextLabel, TweenInfos.Standard, {TextColor3 = Colors.TextPrimary})
		end)

		local Elements = {}

		-- Optimization: Reusable hover function with SafeTween
		local function ApplyButtonHoverEffect(Button, NormalColor, HoverColor)
			Button.MouseEnter:Connect(function()
				SafeTween(Button, TweenInfos.Standard, {BackgroundColor3 = HoverColor})
			end)

			Button.MouseLeave:Connect(function()
				SafeTween(Button, TweenInfos.Standard, {BackgroundColor3 = NormalColor})
			end)
		end

		function Elements:Button(Text, Callback)
			local Button = Instance.new("TextButton")
			Button.Name = "Button"
			Button.Parent = Page
			Button.BackgroundColor3 = Colors.PrimaryDark
			Button.BorderSizePixel = 0
			Button.Size = UDim2.new(1, -6, 0, 34)
			Button.AutoButtonColor = false
			Button.Font = Enum.Font.Gotham
			Button.Text = Text or "Button"
			Button.TextColor3 = Colors.TextPrimary
			Button.TextSize = 14
			Button.TextXAlignment = Enum.TextXAlignment.Center

			local ButtonCorner = Instance.new("UICorner")
			ButtonCorner.CornerRadius = UDim.new(0, 6)
			ButtonCorner.Parent = Button

			ApplyButtonHoverEffect(Button, Colors.PrimaryDark, Colors.PrimaryHover)

			Button.MouseButton1Click:Connect(function()
				if Callback then
					pcall(Callback)
				end
			end)
		end

		function Elements:Toggle(Text, Default, Callback)
			local Toggle = Instance.new("TextButton")
			Toggle.Name = "Toggle"
			Toggle.Parent = Page
			Toggle.BackgroundColor3 = Colors.ElementBackground
			Toggle.BorderSizePixel = 0
			Toggle.Size = UDim2.new(1, -6, 0, 34)
			Toggle.AutoButtonColor = false
			Toggle.Text = ""

			local ToggleCorner = Instance.new("UICorner")
			ToggleCorner.CornerRadius = UDim.new(0, 6)
			ToggleCorner.Parent = Toggle

			local Title = Instance.new("TextLabel")
			Title.Name = "Title"
			Title.Parent = Toggle
			Title.BackgroundTransparency = 1
			Title.Position = UDim2.new(0, 8, 0, 0)
			Title.Size = UDim2.new(1, -6, 1, 0)
			Title.Font = Enum.Font.Gotham
			Title.Text = Text or "Toggle"
			Title.TextColor3 = Colors.TextPrimary
			Title.TextSize = 14
			Title.TextXAlignment = Enum.TextXAlignment.Left

			local ToggleFrame = Instance.new("Frame")
			ToggleFrame.Name = "ToggleFrame"
			ToggleFrame.Parent = Toggle
			ToggleFrame.AnchorPoint = Vector2.new(1, 0.5)
			ToggleFrame.BackgroundColor3 = Color3.fromRGB(12, 59, 161)
			ToggleFrame.BackgroundTransparency = 1
			ToggleFrame.BorderSizePixel = 0
			ToggleFrame.Position = UDim2.new(1, -8, 0.5, 0)
			ToggleFrame.Size = UDim2.new(0, 14, 0, 14)

			local ToggleCornerTwo = Instance.new("UICorner")
			ToggleCornerTwo.CornerRadius = UDim.new(0, 3)
			ToggleCornerTwo.Parent = ToggleFrame

			local Check = Instance.new("ImageLabel")
			Check.Name = "Check"
			Check.Parent = ToggleFrame
			Check.BackgroundTransparency = 1
			Check.Position = UDim2.new(-0.214285731, 0, -0.214285731, 0)
			Check.Size = UDim2.new(0, 20, 0, 20)
			Check.Image = "http://www.roblox.com/asset/?id=7812909048"
			Check.ImageTransparency = 1
			Check.ScaleType = Enum.ScaleType.Fit

			local ToggleStroke = Instance.new("UIStroke")
			ToggleStroke.Parent = ToggleFrame
			ToggleStroke.LineJoinMode = Enum.LineJoinMode.Round
			ToggleStroke.Thickness = 2
			ToggleStroke.Color = Color3.fromRGB(12, 59, 161)

			local Toggled = (Default ~= nil and Default) or false

			local function UpdateToggleVisuals()
				SafeTween(ToggleFrame, TweenInfos.Fast, {BackgroundTransparency = Toggled and 0 or 1})
				SafeTween(Check, TweenInfos.Fast, {ImageTransparency = Toggled and 0 or 1})
			end

			if Toggled then
				UpdateToggleVisuals()
			end

			Toggle.MouseEnter:Connect(function()
				SafeTween(Toggle, TweenInfos.Standard, {BackgroundColor3 = Colors.ElementHover})
			end)

			Toggle.MouseLeave:Connect(function()
				SafeTween(Toggle, TweenInfos.StandardIn, {BackgroundColor3 = Colors.ElementBackground})
			end)

			Toggle.MouseButton1Click:Connect(function()
				Toggled = not Toggled
				UpdateToggleVisuals()
				if Callback then
					pcall(Callback, Toggled)
				end
			end)

			local ToggleFunctions = {}
			function ToggleFunctions:Set(Value)
				Toggled = Value
				UpdateToggleVisuals()
				if Callback then
					pcall(Callback, Toggled)
				end
			end
			return ToggleFunctions
		end

		function Elements:Label(Text)
			local Label = Instance.new("TextLabel")
			Label.Parent = Page
			Label.BackgroundColor3 = Colors.ElementBackground
			Label.BorderSizePixel = 0
			Label.Size = UDim2.new(1, -6, 0, 34)
			Label.Font = Enum.Font.Gotham
			Label.Text = Text or "Label"
			Label.TextColor3 = Colors.TextPrimary
			Label.TextSize = 14
			Label.TextXAlignment = Enum.TextXAlignment.Center

			local LabelCorner = Instance.new("UICorner")
			LabelCorner.CornerRadius = UDim.new(0, 6)
			LabelCorner.Parent = Label

			local LabelFunctions = {}
			function LabelFunctions:Set(NewText)
				Label.Text = NewText or "Label"
			end
			return LabelFunctions
		end

		function Elements:Slider(Text, Min, Max, Default, Increment, Callback)
			Min = Min or 0
			Max = Max or 100
			Default = Default or Min
			Increment = Increment or 1

			if Min >= Max then
				warn("Slider: Min must be less than Max. Using defaults.")
				Min = 0
				Max = 100
			end

			local Slider = Instance.new("Frame")
			Slider.Name = "Slider"
			Slider.Parent = Page
			Slider.BackgroundColor3 = Colors.ElementBackground
			Slider.Size = UDim2.new(1, -6, 0, 48)

			local SliderCorner = Instance.new("UICorner")
			SliderCorner.CornerRadius = UDim.new(0, 6)
			SliderCorner.Parent = Slider

			local Title = Instance.new("TextLabel")
			Title.Name = "Title"
			Title.Parent = Slider
			Title.BackgroundTransparency = 1
			Title.Position = UDim2.new(0, 8, 0, 0)
			Title.Size = UDim2.new(1, -6, 0, 34)
			Title.Font = Enum.Font.Gotham
			Title.Text = Text or "Slider"
			Title.TextColor3 = Colors.TextPrimary
			Title.TextSize = 14
			Title.TextXAlignment = Enum.TextXAlignment.Left

			local Value = Instance.new("TextLabel")
			Value.Name = "Value"
			Value.Parent = Slider
			Value.AnchorPoint = Vector2.new(1, 0)
			Value.BackgroundTransparency = 1
			Value.Position = UDim2.new(1, -10, 0, 0)
			Value.Size = UDim2.new(1, 0, 0, 34)
			Value.Font = Enum.Font.Gotham
			Value.Text = tostring(Default)
			Value.TextColor3 = Colors.TextPrimary
			Value.TextSize = 14
			Value.TextXAlignment = Enum.TextXAlignment.Right

			local SliderClick = Instance.new("TextButton")
			SliderClick.Name = "SliderClick"
			SliderClick.Parent = Slider
			SliderClick.AnchorPoint = Vector2.new(0.5, 1)
			SliderClick.BackgroundColor3 = Colors.MediumElement
			SliderClick.Position = UDim2.new(0.5, 0, 1, -8)
			SliderClick.Size = UDim2.new(1, -12, 0, 6)
			SliderClick.AutoButtonColor = false
			SliderClick.Text = ""
			SliderClick.Active = true

			local SliderClickCorner = Instance.new("UICorner")
			SliderClickCorner.CornerRadius = UDim.new(0, 6)
			SliderClickCorner.Parent = SliderClick

			local SliderDrag = Instance.new("Frame")
			SliderDrag.Name = "SliderDrag"
			SliderDrag.Parent = SliderClick
			SliderDrag.BackgroundColor3 = Colors.SecondaryButton
			SliderDrag.Size = UDim2.new((Default - Min) / (Max - Min), 0, 1, 0)

			local SliderDragCorner = Instance.new("UICorner")
			SliderDragCorner.CornerRadius = UDim.new(0, 6)
			SliderDragCorner.Parent = SliderDrag

			local SliderDragging = false
			local CurrentInput = nil
			local SliderConnection

			local function RoundToIncrement(value)
				return Increment == 0 and value or math.floor(value / Increment + 0.5) * Increment
			end

			local function FormatNumber(value)
				local Formatted = string.format("%.4f", value)
				Formatted = Formatted:gsub("0+$", "")
				Formatted = Formatted:gsub("%.$", "")
				return Formatted
			end

			local function UpdateSlider(Percent)
				local RawValue = Min + (Percent * (Max - Min))
				local SliderValue = RoundToIncrement(RawValue)
				local AdjustedPercent = (SliderValue - Min) / (Max - Min)
				SliderDrag.Size = UDim2.new(AdjustedPercent, 0, 1, 0)
				Value.Text = FormatNumber(SliderValue)
				return SliderValue
			end

			-- Optimization: Throttled slider updates using Heartbeat
			local function Slide(Input)
				local Percent = math.clamp((Input.Position.X - SliderClick.AbsolutePosition.X) / SliderClick.AbsoluteSize.X, 0, 1)
				UpdateSlider(Percent)
			end

			local function HandleInputBegan(Input)
				if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
					SliderDragging = true
					CurrentInput = Input
					
					-- Optimization: Use Heartbeat for smooth updates
					if SliderConnection then SliderConnection:Disconnect() end
					SliderConnection = RunService.Heartbeat:Connect(function()
						if SliderDragging and CurrentInput then
							Slide(CurrentInput)
						end
					end)
					
					local ChangedConn
					ChangedConn = Input.Changed:Connect(function()
						if Input.UserInputState == Enum.UserInputState.End then
							SliderDragging = false
							if SliderConnection then
								SliderConnection:Disconnect()
								SliderConnection = nil
							end
							local FinalPercent = math.clamp((Input.Position.X - SliderClick.AbsolutePosition.X) / SliderClick.AbsoluteSize.X, 0, 1)
							local FinalValue = UpdateSlider(FinalPercent)
							if Callback then
								pcall(Callback, FinalValue)
							end
							ChangedConn:Disconnect()
						end
					end)
				end
			end

			SliderClick.InputBegan:Connect(HandleInputBegan)

			-- Optimization: Track input changes
			UserInputService.InputChanged:Connect(function(Input)
				if SliderDragging and Input == CurrentInput then
					CurrentInput = Input
				end
			end)

			local TouchArea = Instance.new("TextButton")
			TouchArea.Name = "TouchArea"
			TouchArea.Parent = SliderClick
			TouchArea.BackgroundTransparency = 1
			TouchArea.Size = UDim2.new(1, 0, 1, 0)
			TouchArea.Text = ""
			TouchArea.ZIndex = 2
			TouchArea.Active = true
			TouchArea.InputBegan:Connect(HandleInputBegan)
		end

		function Elements:InputBox(Text, Placeholder, Callback)
			local InputBox = Instance.new("Frame")
			InputBox.Name = "InputBox"
			InputBox.Parent = Page
			InputBox.BackgroundColor3 = Colors.ElementBackground
			InputBox.BorderSizePixel = 0
			InputBox.Size = UDim2.new(1, -6, 0, 34)

			local InputBoxCorner = Instance.new("UICorner")
			InputBoxCorner.CornerRadius = UDim.new(0, 6)
			InputBoxCorner.Parent = InputBox

			local Title = Instance.new("TextLabel")
			Title.Name = "Title"
			Title.Parent = InputBox
			Title.BackgroundTransparency = 1
			Title.Position = UDim2.new(0, 8, 0, 0)
			Title.Size = UDim2.new(0.4, -6, 1, 0)
			Title.Font = Enum.Font.Gotham
			Title.Text = Text or "Input"
			Title.TextColor3 = Colors.TextPrimary
			Title.TextSize = 14
			Title.TextXAlignment = Enum.TextXAlignment.Left

			local BoxContainer = Instance.new("Frame")
			BoxContainer.Name = "BoxContainer"
			BoxContainer.Parent = InputBox
			BoxContainer.BackgroundTransparency = 1
			BoxContainer.AnchorPoint = Vector2.new(1, 0.5)
			BoxContainer.Position = UDim2.new(1, -6, 0.5, 0)
			BoxContainer.Size = UDim2.new(0.55, -12, 0, 24)
			BoxContainer.ClipsDescendants = true

			local Box = Instance.new("TextBox")
			Box.Name = "Box"
			Box.Parent = BoxContainer
			Box.BackgroundColor3 = Colors.DarkElement
			Box.BorderSizePixel = 0
			Box.Size = UDim2.new(1, 0, 1, 0)
			Box.Font = Enum.Font.Gotham
			Box.PlaceholderText = Placeholder or "Enter text..."
			Box.PlaceholderColor3 = Colors.TextPlaceholder
			Box.Text = ""
			Box.TextColor3 = Colors.TextPrimary
			Box.TextSize = 14
			Box.TextXAlignment = Enum.TextXAlignment.Center

			local BoxCorner = Instance.new("UICorner")
			BoxCorner.CornerRadius = UDim.new(0, 4)
			BoxCorner.Parent = Box

			Box.FocusLost:Connect(function(EnterPressed)
				if Callback and (EnterPressed or not Box:IsFocused()) then
					pcall(Callback, Box.Text)
				end
			end)

			local HoverFrame = Instance.new("TextButton")
			HoverFrame.Name = "HoverFrame"
			HoverFrame.Parent = InputBox
			HoverFrame.BackgroundColor3 = Colors.ElementBackground
			HoverFrame.BorderSizePixel = 0
			HoverFrame.Size = UDim2.new(1, 0, 1, 0)
			HoverFrame.AutoButtonColor = false
			HoverFrame.Text = ""
			HoverFrame.ZIndex = 0

			HoverFrame.MouseEnter:Connect(function()
				SafeTween(InputBox, TweenInfos.Standard, {BackgroundColor3 = Colors.ElementHover})
			end)

			HoverFrame.MouseLeave:Connect(function()
				SafeTween(InputBox, TweenInfos.StandardIn, {BackgroundColor3 = Colors.ElementBackground})
			end)

			HoverFrame.MouseButton1Click:Connect(function()
				Box:CaptureFocus()
			end)
		end

		function Elements:Dropdown(Text, Options, Callback)
			Options = Options or {}

			local Dropdown = Instance.new("Frame")
			Dropdown.Name = "Dropdown"
			Dropdown.Parent = Page
			Dropdown.BackgroundTransparency = 1
			Dropdown.BorderSizePixel = 0
			Dropdown.ClipsDescendants = false
			Dropdown.Size = UDim2.new(1, -6, 0, 34)

			local Choose = Instance.new("Frame")
			Choose.Name = "Choose"
			Choose.Parent = Dropdown
			Choose.BackgroundColor3 = Colors.ElementBackground
			Choose.BorderSizePixel = 0
			Choose.Size = UDim2.new(1, 0, 0, 34)

			local ChooseCorner = Instance.new("UICorner")
			ChooseCorner.CornerRadius = UDim.new(0, 6)
			ChooseCorner.Parent = Choose

			local Title = Instance.new("TextLabel")
			Title.Name = "Title"
			Title.Parent = Choose
			Title.BackgroundTransparency = 1
			Title.Position = UDim2.new(0, 8, 0, 0)
			Title.Size = UDim2.new(1, -46, 1, 0)
			Title.Font = Enum.Font.Gotham
			Title.Text = Text or "Dropdown"
			Title.TextColor3 = Colors.TextPrimary
			Title.TextSize = 14
			Title.TextXAlignment = Enum.TextXAlignment.Left

			local Arrow = Instance.new("ImageButton")
			Arrow.Name = "Arrow"
			Arrow.Parent = Choose
			Arrow.AnchorPoint = Vector2.new(1, 0.5)
			Arrow.BackgroundTransparency = 1
			Arrow.Position = UDim2.new(1, -8, 0.5, 0)
			Arrow.Size = UDim2.new(0, 20, 0, 20)
			Arrow.Image = "rbxassetid://3926307971"
			Arrow.ImageColor3 = Color3.fromRGB(12, 59, 161)
			Arrow.ImageRectOffset = Vector2.new(324, 524)
			Arrow.ImageRectSize = Vector2.new(36, 36)
			Arrow.ScaleType = Enum.ScaleType.Fit

			local OptionHolder = Instance.new("Frame")
			OptionHolder.Name = "OptionHolder"
			OptionHolder.Parent = Page
			OptionHolder.BackgroundColor3 = Colors.ElementBackground
			OptionHolder.BorderSizePixel = 0
			OptionHolder.Position = UDim2.new(0, 0, 0, 0)
			OptionHolder.Size = UDim2.new(1, -6, 0, 0)
			OptionHolder.Visible = false
			OptionHolder.ZIndex = 100
			OptionHolder.ClipsDescendants = false

			local OptionHolderCorner = Instance.new("UICorner")
			OptionHolderCorner.CornerRadius = UDim.new(0, 6)
			OptionHolderCorner.Parent = OptionHolder

			local OptionList = Instance.new("UIListLayout")
			OptionList.Name = "OptionList"
			OptionList.Parent = OptionHolder
			OptionList.HorizontalAlignment = Enum.HorizontalAlignment.Center
			OptionList.SortOrder = Enum.SortOrder.LayoutOrder
			OptionList.Padding = UDim.new(0, 5)

			local OptionPadding = Instance.new("UIPadding")
			OptionPadding.Parent = OptionHolder
			OptionPadding.PaddingTop = UDim.new(0, 8)
			OptionPadding.PaddingLeft = UDim.new(0, 8)
			OptionPadding.PaddingRight = UDim.new(0, 8)
			OptionPadding.PaddingBottom = UDim.new(0, 8)

			-- Optimization: Batched canvas updates
			OptionList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
				local ContentHeight = OptionList.AbsoluteContentSize.Y + 16
				OptionHolder.Size = UDim2.new(1, -6, 0, ContentHeight)
			end)

			local Dropped = false
			local InputConnection = nil

			local function RefreshOptions(NewOptions)
				NewOptions = NewOptions or {}
				
				-- Optimization: Batch clear old options
				for _, Child in ipairs(OptionHolder:GetChildren()) do
					if Child:IsA("TextButton") then
						Child:Destroy()
					end
				end
				
				Title.Text = Text or "Dropdown"
				
				if #NewOptions == 0 then
					local NoOption = Instance.new("TextButton")
					NoOption.Name = "NoOption"
					NoOption.Parent = OptionHolder
					NoOption.BackgroundColor3 = Colors.MediumElement
					NoOption.BorderSizePixel = 0
					NoOption.Size = UDim2.new(1, -16, 0, 30)
					NoOption.Font = Enum.Font.Gotham
					NoOption.Text = "No Options Available"
					NoOption.TextColor3 = Colors.TextPlaceholder
					NoOption.TextSize = 14
					NoOption.TextXAlignment = Enum.TextXAlignment.Center
					NoOption.AutoButtonColor = false

					local NoOptionCorner = Instance.new("UICorner")
					NoOptionCorner.CornerRadius = UDim.new(0, 6)
					NoOptionCorner.Parent = NoOption
				else
					for _, Option in ipairs(NewOptions) do
						local OptionButton = Instance.new("TextButton")
						OptionButton.Name = "Option"
						OptionButton.Parent = OptionHolder
						OptionButton.BackgroundColor3 = Colors.PrimaryDark
						OptionButton.BorderSizePixel = 0
						OptionButton.Size = UDim2.new(1, -16, 0, 30)
						OptionButton.AutoButtonColor = false
						OptionButton.Font = Enum.Font.Gotham
						OptionButton.Text = Option
						OptionButton.TextColor3 = Colors.TextPrimary
						OptionButton.TextSize = 14
						OptionButton.TextXAlignment = Enum.TextXAlignment.Center

						local OptionCorner = Instance.new("UICorner")
						OptionCorner.CornerRadius = UDim.new(0, 6)
						OptionCorner.Parent = OptionButton

						OptionButton.MouseButton1Click:Connect(function()
							if Callback then
								pcall(Callback, Option)
							end
							Title.Text = (Text or "Dropdown") .. ": " .. Option
							Dropped = false
							OptionHolder.Visible = false
							Arrow.Rotation = 0
						end)

						ApplyButtonHoverEffect(OptionButton, Colors.PrimaryDark, Colors.PrimaryHover)
					end
				end
			end

			RefreshOptions(Options)

			Arrow.MouseButton1Click:Connect(function()
				Dropped = not Dropped
				if Dropped then
					OptionHolder.Visible = true
					Arrow.Rotation = 180
					
					-- Optimization: Defer position calculation
					task.defer(function()
						if not OptionHolder.Parent then return end
						local ChooseAbsolutePosition = Choose.AbsolutePosition
						local ChooseAbsoluteSize = Choose.AbsoluteSize
						local PageAbsolutePosition = Page.AbsolutePosition
						local XPos = ChooseAbsolutePosition.X - PageAbsolutePosition.X
						local YPos = (ChooseAbsolutePosition.Y - PageAbsolutePosition.Y) + ChooseAbsoluteSize.Y + 5
						OptionHolder.Position = UDim2.new(0, XPos, 0, YPos)
					end)
				else
					OptionHolder.Visible = false
					Arrow.Rotation = 0
				end
			end)

			local function CloseDropdown()
				if Dropped then
					Dropped = false
					OptionHolder.Visible = false
					Arrow.Rotation = 0
				end
			end

			local function OnInputBegan(Input)
				if Dropped and Input.UserInputType == Enum.UserInputType.MouseButton1 then
					local MousePos = Input.Position
					local OptionHolderAbsPos = OptionHolder.AbsolutePosition
					local OptionHolderAbsSize = OptionHolder.AbsoluteSize
					local ChooseAbsPos = Choose.AbsolutePosition
					local ChooseAbsSize = Choose.AbsoluteSize
					local IsClickInsideChoose = MousePos.X >= ChooseAbsPos.X and MousePos.X <= ChooseAbsPos.X + ChooseAbsSize.X and
						MousePos.Y >= ChooseAbsPos.Y and MousePos.Y <= ChooseAbsPos.Y + ChooseAbsSize.Y
					local IsClickInsideOptions = MousePos.X >= OptionHolderAbsPos.X and MousePos.X <= OptionHolderAbsPos.X + OptionHolderAbsSize.X and
						MousePos.Y >= OptionHolderAbsPos.Y and MousePos.Y <= OptionHolderAbsPos.Y + OptionHolderAbsSize.Y
					if not (IsClickInsideChoose or IsClickInsideOptions) then
						CloseDropdown()
					end
				end
			end

			InputConnection = UserInputService.InputBegan:Connect(OnInputBegan)

			Dropdown.Destroying:Connect(function()
				if InputConnection then
					InputConnection:Disconnect()
					InputConnection = nil
				end
			end)

			local DropdownFunctions = {}
			function DropdownFunctions:Refresh(NewOptions)
				RefreshOptions(NewOptions)
				Dropped = false
				OptionHolder.Visible = false
				Arrow.Rotation = 0
			end
			return DropdownFunctions
		end

		if not FirstTabCreated then
			FirstTabCreated = true
			Page.Visible = true
			SafeTween(TabButton, TweenInfos.Standard, {BackgroundTransparency = 0.6})
			SafeTween(TextLabel, TweenInfos.Standard, {TextColor3 = Colors.TextPrimary})
		end

		return Elements
	end

	return TabFunctions
end

return Library