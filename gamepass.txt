local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/iaineverseen/files/refs/heads/main/Sentinel.min.lua"))()

local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer

local Window = Library:Window("Free Product Finder")
local MainTab = Window:Tab("Main")

local State = {
    passes = {},
    selected = nil,
    looping = false,
    speed = 0.01
}

local GamePassDropdown
local LoopToken = 0

local function HasSelected()
    return State.selected and State.selected.ID
end

local function FetchProducts()
    State.passes = {}
    local success, page = pcall(MarketplaceService.GetDeveloperProductsAsync, MarketplaceService)
    
    if success and page then
        for _, info in ipairs(page:GetCurrentPage()) do
            if info and info.ProductId then
                table.insert(State.passes, {
                    Name = info.Name or "Unnamed",
                    ID = info.ProductId,
                    Description = info.Description or "",
                    Price = info.PriceInRobux or 0
                })
            end
        end
    end
    
    local names = {}
    for _, pass in ipairs(State.passes) do
        table.insert(names, pass.Name)
    end
    
    return #names > 0 and names or {"No GamePasses Found"}
end

local function SelectPass(name)
    for _, pass in ipairs(State.passes) do
        if pass.Name == name then
            State.selected = pass
            return
        end
    end
    State.selected = nil
end

local function Purchase(id)
    if not id then return end
    pcall(MarketplaceService.SignalPromptProductPurchaseFinished, MarketplaceService, LocalPlayer.UserId, id, true)
end

local function LoopStart()
    if not HasSelected() then return end
    LoopToken += 1
    local token = LoopToken
    State.looping = true
    
    task.spawn(function()
        while State.looping and token == LoopToken and HasSelected() do
            Purchase(State.selected.ID)
            task.wait(State.speed)
        end
    end)
end

local function LoopStop()
    State.looping = false
    LoopToken += 1
end

local function Refresh()
    LoopStop()
    State.selected = nil
    return FetchProducts()
end

local function CopyBuyScript()
    if not HasSelected() then return end
    
    local scriptTemplate = 
[[
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local function Purchase(productId)
    pcall(function()
        MarketplaceService:SignalPromptProductPurchaseFinished(LocalPlayer.UserId, productId, true)
    end)
end
Purchase(%d)
]]
    
    local scriptCode = string.format(scriptTemplate, State.selected.ID)
    setclipboard(scriptCode)
end

GamePassDropdown = MainTab:Dropdown("Select Game Pass", FetchProducts(), function(name)
    SelectPass(name)
    LoopStop()
end)

MainTab:Button("Buy Selected Game Pass", function()
    if HasSelected() then
        Purchase(State.selected.ID)
    end
end)

MainTab:Button("Buy All Game Passes", function()
    for _, pass in ipairs(State.passes) do
        Purchase(pass.ID)
    end
end)

MainTab:Toggle("Loop Buy Selected Game Pass", false, function(on)
    if on and HasSelected() then
        LoopStart()
    else
        LoopStop()
    end
end)

MainTab:Slider("Loop Buy Speed", 0.01, 1, 0.01, function(v)
    State.speed = v
end)

MainTab:Button("Copy Selected Game Pass ID", function()
    if HasSelected() then
        setclipboard(tostring(State.selected.ID))
    end
end)

MainTab:Button("Copy Buy Script (Standalone)", function()
    CopyBuyScript()
end)

MainTab:Button("Refresh Game Pass List", function()
    GamePassDropdown:RefreshDropdown(Refresh())
end)