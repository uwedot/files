local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/iaineverseen/files/refs/heads/main/Sentinel.txt"))()

local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer

local Window = Library:Window("Free Product Finder")
local MainTab = Window:Tab("Main")

local State = {
    passes = {},
    selected = nil,
    looping = false,
    speed = 0.1
}

local GamePassDropdown
local LoopToken = 0

local function HasSelected()
    return State.selected and State.selected.ID
end

local function FetchProducts()
    State.passes = {}
    local ok, page = pcall(MarketplaceService.GetDeveloperProductsAsync, MarketplaceService)
    if ok and page then
        local cur = page:GetCurrentPage()
        if cur then
            for _, info in ipairs(cur) do
                if info and info.ProductId then
                    table.insert(State.passes, {
                        Name = info.Name or "Unnamed",
                        ID = info.ProductId,
                        Description = info.Description or "",
                        Price = info.PriceInRobux or 0
                    })
                end
            end
        end
    end
    local names = {}
    for _, pass in ipairs(State.passes) do
        table.insert(names, pass.Name)
    end
    return (#names > 0) and names or {"No GamePasses Found"}
end

local function SelectPass(name)
    State.selected = nil
    for _, pass in ipairs(State.passes) do
        if pass.Name == name then
            State.selected = pass
            break
        end
    end
end

local function Purchase(id)
    if not id then return end
    pcall(function()
        MarketplaceService:SignalPromptProductPurchaseFinished(LocalPlayer.UserId, id, true)
    end)
end

local function LoopStart()
    if not HasSelected() then return end
    LoopToken += 1
    local token = LoopToken
    State.looping = true
    task.spawn(function()
        while State.looping and token == LoopToken and HasSelected() do
            Purchase(State.selected.ID)
            task.wait(State.speed)
        end
    end)
end

local function LoopStop()
    State.looping = false
    LoopToken += 1
end

local function Refresh()
    LoopStop()
    State.selected = nil
    return FetchProducts()
end

local initial = FetchProducts()

GamePassDropdown = MainTab:Dropdown("Select Game Pass", initial, function(name)
    SelectPass(name)
    LoopStop()
end)

MainTab:Button("Buy Selected Game Pass", function()
    if HasSelected() then
        Purchase(State.selected.ID)
    end
end)

MainTab:Button("Buy All Game Passes", function()
    for _, pass in ipairs(State.passes) do
        Purchase(pass.ID)
    end
end)

MainTab:Toggle("Loop Buy Selected Game Pass", false, function(on)
    if on then
        if HasSelected() then
            LoopStart()
        else
            LoopStop()
        end
    else
        LoopStop()
    end
end)

MainTab:Slider("Loop Buy Speed", 0.01, 1, 0.01, function(v)
    State.speed = v
end)

MainTab:Button("Refresh Game Pass List", function()
    local new = Refresh()
    if GamePassDropdown and GamePassDropdown.RefreshDropdown then
        GamePassDropdown:RefreshDropdown(new)
    end
end)